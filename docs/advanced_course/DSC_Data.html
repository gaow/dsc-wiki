<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>DSC data flow</title>
  <meta name="description" content="DSC data storage">

  <link rel="canonical" href="https://stephenslab.github.io/dsc-wiki/advanced_course/DSC_Data.html">
  <link rel="alternate" type="application/rss+xml" title="DSC" href="https://stephenslab.github.io/dsc-wiki/feed.xml">

  <meta property="og:url"         content="https://stephenslab.github.io/dsc-wiki/advanced_course/DSC_Data.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="DSC data flow" />
<meta property="og:description" content="DSC data storage" />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "https://stephenslab.github.io/dsc-wiki/advanced_course/DSC_Data.html",
  "headline":
    "DSC data flow",
  "datePublished":
    "2019-01-09T18:23:43-06:00",
  "dateModified":
    "2019-01-09T18:23:43-06:00",
  "description":
    "DSC data storage",
  "author": {
    "@type": "Person",
    "name": "Stephens Lab, University of Chicago"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "https://stephenslab.github.io/dsc-wiki",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://stephenslab.github.io/dsc-wiki",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/dsc-wiki/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/dsc-wiki/images/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

// Helper function to init things quickly
initFunction = function(myfunc) {
  runWhenDOMLoaded(myfunc);
  document.addEventListener('turbolinks:load', myfunc);
};
</script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/dsc-wiki';
  </script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/dsc-wiki/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  <script src="https://unpkg.com/nbinteract-core" async></script>

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->


  <!-- Google analytics -->
  <script src="/dsc-wiki/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load JS that depends on site variables -->
  <script>
/**
 * Set up copy/paste for code blocks
 */
const codeCellId = index => `codecell${index}`

const clipboardButton = id =>
  `<a class="btn copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#${id}">
    <img src="/dsc-wiki/assets/images/copy-button.svg" alt="Copy to clipboard">
  </a>`

// Clears selected text since ClipboardJS will select the text when copying
const clearSelection = () => {
  if (window.getSelection) {
    window.getSelection().removeAllRanges()
  } else if (document.selection) {
    document.selection.empty()
  }
}

// Changes tooltip text for two seconds, then changes it back
const temporarilyChangeTooltip = (el, newText) => {
  const oldText = el.getAttribute('data-tooltip')
  el.setAttribute('data-tooltip', newText)
  setTimeout(() => el.setAttribute('data-tooltip', oldText), 2000)
}

const addCopyButtonToCodeCells = () => {
  // If ClipboardJS hasn't loaded, wait a bit and try again. This
  // happens because we load ClipboardJS asynchronously.
  if (window.ClipboardJS === undefined) {
    setTimeout(addCopyButtonToCodeCells, 250)
    return
  }

  const codeCells = document.querySelectorAll('.input_area pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.querySelector(`pre#${id} + a`) == null) {
      codeCell.insertAdjacentHTML('afterend', clipboardButton(id));
    }
  })

  const clipboard = new ClipboardJS('.copybtn')
  clipboard.on('success', event => {
    clearSelection()
    temporarilyChangeTooltip(event.trigger, 'Copied!')
  })

  clipboard.on('error', event => {
    temporarilyChangeTooltip(event.trigger, 'Failed to copy')
  })

  // Get rid of clipboard before the next page visit to avoid memory leak
  document.addEventListener('turbolinks:before-visit', () =>
    clipboard.destroy()
  )
}

initFunction(addCopyButtonToCodeCells);
</script>
  
  <!-- Hide cell code -->
  

  <!-- Load custom website scripts -->
  <script src="/dsc-wiki/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/dsc-wiki/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/dsc-wiki/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  
</head>

  <body>
    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      
      <!-- Shamelessly copied from minimal mistakes -->


<!-- TOC will only show up if it has at least one item -->


  <aside class="sidebar__right">
    <nav class="onthispage">
      <header><h4 class="nav__title"><i class="fa fa-list"></i>   On this page</h4></header>
      <ul class="toc__menu">
  <li><a href="#dsc-variables">DSC variables</a>
    <ul>
      <li><a href="#a-note-on-performance">A note on performance</a></li>
    </ul>
  </li>
  <li><a href="#dsc-parameters">DSC parameters</a>
    <ul>
      <li><a href="#basic-behavior">Basic behavior</a></li>
      <li><a href="#advanced-behavior">Advanced behavior</a></li>
    </ul>
  </li>
</ul>
    </nav>
  </aside>



      <main class="c-textbook__page" tabindex="-1">
          <div class="o-wrapper">
            <div class="c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

            

            <div class="c-textbook__content">
              <h1 id="dsc-data-storage">DSC data storage</h1>

<p>This documentation discusses how DSC variables and parameters are handled and stored. The former is relevant to how one think about data flow when developing the benchmark; the latter is relevant to how parameters are used in 1) user provided scripts when executing benchmark and 2) user specified filter conditions when making queries on results.</p>

<h2 id="dsc-variables">DSC variables</h2>

<p>DSC variables are module input and output. Since a module input is always output from another module we focus our discussion on handling of module outputs.</p>

<p>When working in pure R or Python environments users do not have to worry about how module outputs are stored, because all data objects will flow across modules without loss of information using serialized files. Specifically we use <a href="http://www.inside-r.org/r-doc/base/saverds"><code class="highlighter-rouge">RDS</code></a> for R, and <code class="highlighter-rouge">pickle</code> for Python. Under the hood one such file is generated per module instance to include all output variables.</p>

<p>For mixed languages, currently for R and Python, our solution is to use an <code class="highlighter-rouge">rpy2</code> interface to convert between <code class="highlighter-rouge">RDS</code> and <code class="highlighter-rouge">pickle</code> data to communicate between modules. Caution that information exchanges is no longer loss-less (see <a href="https://github.com/stephenslab/dsc/blob/master/src/dsc_io.py#L33">these codes</a> for how it works – we will continue to improve these utility functions to support more type exchanges). In the future we may switch to <code class="highlighter-rouge">HDF5</code> to support more languages.</p>

<p>In sum, for R and Python scripts users do not need to worry about files when thinking about DSC variables, though bearing in mind the caveat that mixed language communication is not loss-less and only “shareable” types of objects should be used to communicated cross language.</p>

<h3 id="a-note-on-performance">A note on performance</h3>

<p>Saving and loading intermediate files can be costly in both execution time and disk space; as a result you may notice that it seems to take DSC rather long time to complete a job compared to directly running R or Python scripts involved to complete a job. On the other hand, archiving outcome of computational routines in the form of serialized data files makes it possible to re-use existing results, thus beneficial in the long run, particularly for projects where computational steps are not trivial and there is a need to actively add new computational routines to existing DSC framework.</p>

<p>Other “overhead” of DSC include:</p>

<ol>
  <li>Executing every single module instance as separate external commands, eg. <code class="highlighter-rouge">Rscript script.R</code> rather than running all in one opened R session. This helps parallel to many nodes on a cluster, yet can appear to be slower for light jobs on a local computer.</li>
  <li>Workflow related features, such as building execution graph, archiving file hash and checking them.</li>
</ol>

<h2 id="dsc-parameters">DSC parameters</h2>

<h3 id="basic-behavior">Basic behavior</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">type</th>
      <th style="text-align: center">DSC interface</th>
      <th style="text-align: center">DSC processed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">un-quoted string</td>
      <td style="text-align: center"><code class="highlighter-rouge">NULL</code>, <code class="highlighter-rouge">TRUE</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">NULL</code>, <code class="highlighter-rouge">TRUE</code></td>
    </tr>
    <tr>
      <td style="text-align: center">quoted string</td>
      <td style="text-align: center"><code class="highlighter-rouge">"a"</code>, <code class="highlighter-rouge">'a'</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">"a"</code>, <code class="highlighter-rouge">'a'</code></td>
    </tr>
    <tr>
      <td style="text-align: center">int</td>
      <td style="text-align: center"><code class="highlighter-rouge">1</code>, <code class="highlighter-rouge">1.0</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">1</code>, <code class="highlighter-rouge">1</code></td>
    </tr>
    <tr>
      <td style="text-align: center">float</td>
      <td style="text-align: center"><code class="highlighter-rouge">3.14</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">3.14</code></td>
    </tr>
    <tr>
      <td style="text-align: center">1-D vector</td>
      <td style="text-align: center"><code class="highlighter-rouge">(1,2,3)</code></td>
      <td style="text-align: center">language specific</td>
    </tr>
  </tbody>
</table>

<h3 id="advanced-behavior">Advanced behavior</h3>

<p><strong>FIXME: document <code class="highlighter-rouge">R()</code>, <code class="highlighter-rouge">R{}</code> etc or at least refer to where they are documented; document 1-D vector for different languages; document nested vector</strong></p>

              <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/dsc-wiki/advanced_course/5_Minutes_Python">
      〈 <span class="u-margin-right-tiny"></span> Working with Python
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/dsc-wiki/advanced_course/5_Minutes_RPY">
      Working with R and Python <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

            </div>
          </div>
        </div>
      </main>
    </div>

  </body>
</html>
