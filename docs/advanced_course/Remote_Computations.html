<!DOCTYPE html>
<html lang="en">
  

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Running DSC on remote computers</title>
  <meta name="description" content="Running DSC on a computer cluster">

  <link rel="canonical" href="https://stephenslab.github.io/dsc-wiki/advanced_course/Remote_Computations.html">
  <link rel="alternate" type="application/rss+xml" title="DSC" href="https://stephenslab.github.io/dsc-wiki/feed.xml">

  <meta property="og:url"         content="https://stephenslab.github.io/dsc-wiki/advanced_course/Remote_Computations.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Running DSC on remote computers" />
<meta property="og:description" content="Running DSC on a computer cluster" />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "https://stephenslab.github.io/dsc-wiki/advanced_course/Remote_Computations.html",
  "headline":
    "Running DSC on remote computers",
  "datePublished":
    "2019-09-17T15:41:18-05:00",
  "dateModified":
    "2019-09-17T15:41:18-05:00",
  "description":
    "Running DSC on a computer cluster",
  "author": {
    "@type": "Person",
    "name": "Stephens Lab, University of Chicago"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "https://stephenslab.github.io/dsc-wiki",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://stephenslab.github.io/dsc-wiki",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/dsc-wiki/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/dsc-wiki/images/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

// Helper function to init things quickly
initFunction = function(myfunc) {
  runWhenDOMLoaded(myfunc);
  document.addEventListener('turbolinks:load', myfunc);
};
</script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/dsc-wiki';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="/dsc-wiki/assets/js/anchor.min.js"  type="text/javascript"></script>
  <script>

initFunction(function () {
    anchors.add("main h1, main h2, main h3, main h4")
});

</script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/dsc-wiki/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->



  <!-- Load the auto-generating TOC -->
  <script src="/dsc-wiki/assets/js/tocbot.min.js"  type="text/javascript"></script>
  <script>
var initToc = function () {
  tocbot.init({
    tocSelector: 'nav.onthispage',
    contentSelector: '.c-textbook__content',
    headingSelector: 'h2, h3',
    orderedList: false,
    collapseDepth: 6,
    listClass: 'toc__menu',
    activeListItemClass: "",  // Not using
    activeLinkClass: "", // Not using
  });
  tocbot.refresh();
}
initFunction(initToc);
</script>

  <!-- Google analytics -->
  <script src="/dsc-wiki/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load JS that depends on site variables -->
  <script>
/**
 * Set up copy/paste for code blocks
 */
const codeCellId = index => `codecell${index}`

const clipboardButton = id =>
  `<a id="copy-button-${id}" class="btn copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#${id}">
    <img src="/dsc-wiki/assets/images/copy-button.svg" alt="Copy to clipboard">
  </a>`

// Clears selected text since ClipboardJS will select the text when copying
const clearSelection = () => {
  if (window.getSelection) {
    window.getSelection().removeAllRanges()
  } else if (document.selection) {
    document.selection.empty()
  }
}

// Changes tooltip text for two seconds, then changes it back
const temporarilyChangeTooltip = (el, newText) => {
  const oldText = el.getAttribute('data-tooltip')
  el.setAttribute('data-tooltip', newText)
  setTimeout(() => el.setAttribute('data-tooltip', oldText), 2000)
}

const addCopyButtonToCodeCells = () => {
  // If ClipboardJS hasn't loaded, wait a bit and try again. This
  // happens because we load ClipboardJS asynchronously.
  if (window.ClipboardJS === undefined) {
    setTimeout(addCopyButtonToCodeCells, 250)
    return
  }

  const codeCells = document.querySelectorAll('div.c-textbook__content > div.highlighter-rouge > div.highlight > pre, div.input_area pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.getElementById("copy-button" + id) == null) {
      codeCell.insertAdjacentHTML('afterend', clipboardButton(id));
    }
  })

  const clipboard = new ClipboardJS('.copybtn')
  clipboard.on('success', event => {
    clearSelection()
    temporarilyChangeTooltip(event.trigger, 'Copied!')
  })

  clipboard.on('error', event => {
    temporarilyChangeTooltip(event.trigger, 'Failed to copy')
  })

  // Get rid of clipboard before the next page visit to avoid memory leak
  document.addEventListener('turbolinks:before-visit', () =>
    clipboard.destroy()
  )
}

initFunction(addCopyButtonToCodeCells);
</script>


  <!-- Hide cell code -->
  
<script>
/**
Add buttons to hide code cells
*/


var setCodeCellVisibility = function(inputField, kind) {
    // Update the image and class for hidden
    var id = inputField.getAttribute('data-id');
    var codeCell = document.querySelector(`#${id} div.highlight`);

    if (kind === "visible") {
        codeCell.classList.remove('hidden');
        inputField.checked = true;
    } else {
        codeCell.classList.add('hidden');
        inputField.checked = false;
    }
}

var toggleCodeCellVisibility = function (event) {
    // The label is clicked, and now we decide what to do based on the input field's clicked status
    if (event.target.tagName === "LABEL") {
        var inputField = event.target.previousElementSibling;
    } else {
        // It is the span inside the target
        var inputField = event.target.parentElement.previousElementSibling;
    }

    if (inputField.checked === true) {
        setCodeCellVisibility(inputField, "visible");
    } else {
        setCodeCellVisibility(inputField, "hidden");
    }
}


// Button constructor
const hideCodeButton = id => `<input class="hidebtn" type="checkbox" id="hidebtn${id}" data-id="${id}"><label title="Toggle cell" for="hidebtn${id}" class="plusminus"><span class="pm_h"></span><span class="pm_v"></span></label>`

var addHideButton = function () {
  // If a hide button is already added, don't add another
  if (document.querySelector('div.hidecode input') !== null) {
      return;
  }

  // Find the input cells and add a hide button
  document.querySelectorAll('div.input_area').forEach(function (item, index) {
    if (!item.classList.contains("hidecode")) {
        // Skip the cell if it doesn't have a hidecode class
        return;
    }

    const id = codeCellId(index)
    item.setAttribute('id', id);
    // Insert the button just inside the end of the next div
    item.querySelector('div').insertAdjacentHTML('beforeend', hideCodeButton(id))

    // Set up the visibility toggle
    hideLink = document.querySelector(`#${id} div.highlight + input + label`);
    hideLink.addEventListener('click', toggleCodeCellVisibility)
  });
}


// Initialize the hide buttos
var initHiddenCells = function () {
    // Add hide buttons to the cells
    addHideButton();

    // Toggle the code cells that should be hidden
    document.querySelectorAll('div.hidecode input').forEach(function (item) {
        setCodeCellVisibility(item, 'hidden');
        item.checked = true;
    })
}

initFunction(initHiddenCells);

</script>


  <!-- Load custom website scripts -->
  <script src="/dsc-wiki/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/dsc-wiki/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/dsc-wiki/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  

  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="/dsc-wiki/assets/js/lunr/lunr.min.js" type="text/javascript"></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>
</head>

  <body>
    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://github.com/stephenslab/dsc"><img src="/dsc-wiki/images/logo.png" class="textbook_logo" id="sidebar-logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">DSC</h2>
  <ul class="c-sidebar__chapters">
    
      
      
        <li class="c-sidebar__chapter"><a class="c-sidebar__entry" href="/dsc-wiki/search.html"><img src="/dsc-wiki/images/search.svg" alt="Search This Wiki"></a></li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/overview.html"
        >
          
          Home
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/installation.html"
        >
          
          Installation
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/faq.html"
        >
          
          FAQ
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/reference/reference.html"
        >
          
          Reference manual
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Terminology.html"
                >
                  
                  Terminology
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/DSC_Configuration.html"
                >
                  
                  DSC configuration syntax
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/DSC_Execution.html"
                >
                  
                  Running DSC
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/DSC_Filtering.html"
                >
                  
                  Extracting DSC results
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Command_Options.html"
                >
                  
                  Command-line reference
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Road_Map.html"
                >
                  
                  Development roadmap
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Implementation_Details.html"
                >
                  
                  Implementation details
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Unsupported_Features.html"
                >
                  
                  Unsupported features
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      
        <li class="c-sidebar__divider"></li>
        
      
      
        <li><h2 class="c-sidebar__title">User guide</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/first_course/first_course.html"
        >
          
          First course on DSC
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Intro_DSC.html"
                >
                  
                  A brief introduction to DSC
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Intro_Syntax_I.html"
                >
                  
                  DSC basics, part I
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Intro_Syntax_II.html"
                >
                  
                  DSC basics, part II
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Prototype_Tips.html"
                >
                  
                  Developing benchmarks
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Debug_Tips.html"
                >
                  
                  Debug in DSC
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Syntax_Tips.html"
                >
                  
                  Syntax tips
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/faq.html"
        >
          
          Other tutorials
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/5_Minutes_Python.html"
                >
                  
                  Working with Python
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/DSC_Data.html"
                >
                  
                  DSC data flow
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/5_Minutes_RPY.html"
                >
                  
                  Working with R and Python
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/Multiple_Pipelines.html"
                >
                  
                  Running multiple pipelines
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/Rmd_Executable.html"
                >
                  
                  Using Rmd files as module executables
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry c-sidebar__entry--active"
                  href="/dsc-wiki/advanced_course/Remote_Computations.html"
                >
                  
                  Running DSC on remote computers
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/DSC_Docker.html"
                >
                  
                  Running DSC in Docker
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/examples.html"
        >
          
          Benchmark examples
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/examples/R_Example_1.html"
                >
                  
                  R Example 1
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/examples/R_Example_2.html"
                >
                  
                  R Example 2
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
  </ul>
  <p class="sidebar_footer">Copyright (c) 2016-2018 <br> <a href="http://home.uchicago.edu/gaow">Gao Wang</a>, <a href="http://stephenslab.uchicago.edu">Matthew Stephens</a>, <a href="https://pcarbo.github.io">Peter Carbonetto</a> and contributors.<br></p>
</nav>

      
      <!-- Empty sidebar placeholder that we'll auto-fill with javascript -->
      <aside class="sidebar__right">
          <header><h4 class="nav__title"><i class="fa fa-list"></i>   Contents</h4></header>
          <nav class="onthispage">
          </nav>
      </aside>
      
      <main class="c-textbook__page" tabindex="-1">
          <div class="o-wrapper">
            <div class="c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

            

            <div class="c-textbook__content">
              <h1 id="running-dsc-on-a-computer-cluster">Running DSC on a computer cluster</h1>

<p>Here we illustrate how DSC can facilitate remote computation. This is
useful when working with a DSC that involves intensive and/or
long-running computations; many of the computations involved are
ammenable to parallel or distributing computation, so we would like to
advantage of a high-performance computing system to speed up running a
benchmark.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>We will use a simple example to demonstrate how to run DSC on a remote
computing system. Although this example is not particularly
well-suited for running on a high-performance compute cluster—it can
be easily run on a standard desktop computer, and the individual
computing tasks are very short—we will use this example to
illustrate the features of DSC for facilitating remote computation. We
will draw from the example presented in
<a href="../first_course/Intro_Syntax_I.html">DSC basics, part I</a>. The source code can be found
<a href="https://github.com/stephenslab/dsc/tree/master/vignettes/one_sample_location">here</a>.</p>

<p>Our aim is to submit it to a remote cluster to generate all the
results. Before doing so, we should make sure it works.</p>

<p>First, run the the “truncate” version of the DSC command to test the
script (see <a href="../first_course/Prototype_Tips.html">here</a> for details):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsc first_investigate_simpler.dsc <span class="nt">--truncate</span>
</code></pre></div></div>

<p>If the “truncated run” reports error, try to
<a href="../first_course/Debug_Tips.html">debug DSC</a> and test again until the truncated run
works.</p>

<p>Now we are ready to submit the DSC to run on computer cluster.</p>

<h2 id="overview-of-running-remote-jobs">Overview of running remote jobs</h2>

<p>DSC uses an additional configuration file and two command options
(<code class="highlighter-rouge">--host</code> and <code class="highlighter-rouge">--to-host</code>) to run on a remote system.</p>

<p>DSC facilicates two approaches to running remote tasks:</p>

<ol>
  <li>
    <p>“On Host”: Log in to the remote computing system (“the host”), and
run DSC with <code class="highlighter-rouge">--host</code> argument. When configured properly, DSC will
automatically submit jobs to the job scheduling system on the host.</p>
  </li>
  <li>
    <p>“Local Host”: Run DSC from local computer with
additional folders to be synced to the host specified by <code class="highlighter-rouge">--to-host</code>
option. The local computer will serve as the job dispatcher and job
monitor. This provides a way to run on hosts whose headnode cannot
execute long running <code class="highlighter-rouge">dsc</code> process and/or whose compute nodes cannot be
used to submit jobs.</p>
  </li>
</ol>

<p>Under the hood, DSC configures all modules and converts them to
<a href="https://vatlab.github.io/sos-docs"><code class="highlighter-rouge">SoS</code></a> tasks. Interested readers may refer to
<a href="https://vatlab.github.io/sos-docs/doc/documentation/Remote_Execution.html">this page</a> for implementation details.</p>

<p><em>Note to RCC users at the University of Chicago:</em> It is recommended to
use the “On Host” mode.</p>

<h2 id="job-configuration-template-and-command-options">Job configuration template and command options</h2>

<p>Using a template and in combination with the command options, DSC
allows users to configure job submission and the resource requirements
for the jobs.</p>

<p>Using command options, users can:</p>

<ol>
  <li>
    <p>Submit the entire benchmark.</p>
  </li>
  <li>
    <p>Automatically upload required files to the host for benchmarking
(when <code class="highlighter-rouge">--to-host</code> is used).</p>
  </li>
</ol>

<p>Users can also use SoS utility tools to manage jobs. See below for a
brief discussion of a few SoS utility commands with examples.</p>

<h2 id="basic-configuration-example">Basic configuration example</h2>

<p>DSC command option <code class="highlighter-rouge">--host</code> accepts a YAML configuration file that
specifies a <em>template</em> for remote jobs. We begin with an example 
illustrating the essential elements of a
configuration file. This example was configured for the
high-performance compute cluster run out of the University of Chicago
(“midway2”), so we have called this file “midway2.yml”. To use this
configuration file to run your benchmark (called “mybenchmark.dsc”),
you would log in to the remote computing system, and run the following
command: <code class="highlighter-rouge">dsc mybenchmark.dsc --host midway2.yml</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">DSC</span><span class="pi">:</span>
  <span class="na">midway2</span><span class="pi">:</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">queue_type</span><span class="pi">:</span> <span class="s">pbs</span>
    <span class="na">status_check_interval</span><span class="pi">:</span> <span class="s">120</span>
    <span class="na">max_running_jobs</span><span class="pi">:</span> <span class="s">10</span>
    <span class="na">job_template</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">#!/bin/bash</span>
      <span class="no">#SBATCH --time=6:00:00</span>
      <span class="no">#SBATCH --partition=broadwl</span>
      <span class="no">#SBATCH --mem=4G</span>
      <span class="no">#SBATCH --exclusive</span>
    <span class="na">submit_cmd</span><span class="pi">:</span> <span class="s">sbatch {job_file}</span>
    <span class="na">submit_cmd_output</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Submitted</span><span class="nv"> </span><span class="s">batch</span><span class="nv"> </span><span class="s">job</span><span class="nv"> </span><span class="s">{job_id}"</span>
    <span class="na">status_cmd</span><span class="pi">:</span> <span class="s">squeue --job {job_id}</span>
    <span class="na">kill_cmd</span><span class="pi">:</span> <span class="s">scancel {job_id}</span>
</code></pre></div></div>

<p>Let’s walk through this configuration file step-by-step:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">DSC</code> is required section title for specifying host configuration.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">midway2</code> is the label assigned to the configuration.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">status_check_interval: 120</code> means that DSC checks the job status
every 120 seconds (2 minutes), and takes action if the job has
failed or completed. It is important to set this interval to a
reasonable period so as not to overload the job scheduling service
when it is being shared with many other users.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">max_running_jobs: 10</code> the maximum number of jobs that will run at
any one time. Again, it is important not to set this to be too large
on a system that is shared with other users.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">job_template</code> entry gives the initial steps that are run to set
up the computing environment for computation in DSC. In this case,
this is a basic bash script with additional instructions for the
<a href="http://slurm.schedmd.com">Slurm</a> job scheduler. The amount of memory and the time
limit in this template is hard-coded for simplicity, but we will demonstrate
later how to adjust them for different modules. In this simple example, the
time limit of 6 hours per job submitted is probably a vast overestimate of 
the actual time needed.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">submit_cmd</code>, <code class="highlighter-rouge">Submitted batch job {job_id}</code>, <code class="highlighter-rouge">squeue
--job</code> and <code class="highlighter-rouge">kill_cmd</code> give additional instructions on how DSC should
interact with the job management system (in this case, the Slurm job
management system).</p>
  </li>
</ul>

<p>This basic configuration file is sufficient to run DSC computations on
a system that uses Slurm; compute systems that use different job
management software (e.g., TORQUE) can be configured similarly.</p>

<h2 id="more-advanced-configuration-example">More advanced configuration example</h2>

<p>Here we provide a more advanced template for use with Slurm on UChicago RCC.
It configures multiple queues <code class="highlighter-rouge">midway2</code>, <code class="highlighter-rouge">faraway2</code> and <code class="highlighter-rouge">stephenslab</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">DSC</span><span class="pi">:</span>
  <span class="na">midway2</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">UChicago RCC cluster Midway 2</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">paths</span><span class="pi">:</span>
      <span class="na">home</span><span class="pi">:</span> <span class="s">/home/kaiqianz</span>
    <span class="na">queue_type</span><span class="pi">:</span> <span class="s">pbs</span>
    <span class="na">status_check_interval</span><span class="pi">:</span> <span class="s">30</span>
    <span class="na">max_running_jobs</span><span class="pi">:</span> <span class="s">50</span>
    <span class="na">max_cores</span><span class="pi">:</span> <span class="s">40</span>
    <span class="na">max_walltime</span><span class="pi">:</span> <span class="s2">"</span><span class="s">36:00:00"</span>
    <span class="na">max_mem</span><span class="pi">:</span> <span class="s">64G</span>
    <span class="na">job_template</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">#!/bin/bash</span>
      <span class="no">#{partition}</span>
      <span class="no">#{account}</span>
      <span class="no">#SBATCH --time={walltime}</span>
      <span class="no">#SBATCH --nodes={nodes}</span>
      <span class="no">#SBATCH --cpus-per-task={cores}</span>
      <span class="no">#SBATCH --mem={mem//10**9}G</span>
      <span class="no">#SBATCH --job-name={job_name}</span>
      <span class="no">#SBATCH --output={cur_dir}/{job_name}.out</span>
      <span class="no">#SBATCH --error={cur_dir}/{job_name}.err</span>
      <span class="no">cd {cur_dir}</span>
      <span class="no">module load R 2&gt; /dev/null</span>
    <span class="na">partition</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SBATCH</span><span class="nv"> </span><span class="s">--partition=broadwl"</span>
    <span class="na">account</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">submit_cmd</span><span class="pi">:</span> <span class="s">sbatch {job_file}</span>
    <span class="na">submit_cmd_output</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Submitted</span><span class="nv"> </span><span class="s">batch</span><span class="nv"> </span><span class="s">job</span><span class="nv"> </span><span class="s">{job_id}"</span>
    <span class="na">status_cmd</span><span class="pi">:</span> <span class="s">squeue --job {job_id}</span>
    <span class="na">kill_cmd</span><span class="pi">:</span> <span class="s">scancel {job_id}</span>
  <span class="na">faraway2</span><span class="pi">:</span>
    <span class="na">based_on</span><span class="pi">:</span> <span class="s">midway2</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Submit and manage jobs to `midway2` from a local computer.</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">kaiqianz@midway2.rcc.uchicago.edu</span>
  <span class="na">stephenslab</span><span class="pi">:</span>
    <span class="na">based_on</span><span class="pi">:</span> <span class="s">midway2</span>
    <span class="na">max_cores</span><span class="pi">:</span> <span class="s">28</span>
    <span class="na">max_mem</span><span class="pi">:</span> <span class="s">128G</span>
    <span class="na">max_walltime</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10d"</span>
    <span class="na">partition</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SBATCH</span><span class="nv"> </span><span class="s">--partition=mstephens"</span>
    <span class="na">account</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SBATCH</span><span class="nv"> </span><span class="s">--account=pi-mstephens"</span>

<span class="na">default</span><span class="pi">:</span>
  <span class="na">queue</span><span class="pi">:</span> <span class="s">midway2</span>
  <span class="na">instances_per_job</span><span class="pi">:</span> <span class="s">40</span>
  <span class="na">nodes_per_job</span><span class="pi">:</span> <span class="s">10</span>
  <span class="na">cpus_per_node</span><span class="pi">:</span> <span class="s">4</span>
  <span class="na">cpus_per_instance</span><span class="pi">:</span> <span class="s">1</span>
  <span class="na">mem_per_instance</span><span class="pi">:</span> <span class="s">2G</span>
  <span class="na">time_per_instance</span><span class="pi">:</span> <span class="s">3m</span>

<span class="na">simulate</span><span class="pi">:</span>
  <span class="na">instances_per_job</span><span class="pi">:</span> <span class="s">20</span>

<span class="na">score</span><span class="pi">:</span>
  <span class="na">queue</span><span class="pi">:</span> <span class="s">midway2.local</span>
</code></pre></div></div>

<p>The section <code class="highlighter-rouge">DSC</code> is required to provide various templates for a
number of systems. Here, <code class="highlighter-rouge">midway2</code> is a host provided by
<a href="https://rcc.uchicago.edu">The Research Computing Center at the University of Chicago</a>. Jobs
are submitted to <code class="highlighter-rouge">partition=broadwl</code>. Typically it has 40 cores per
node. It is recommended that users do not submit more than 60 jobs at
a time, and maximum running time should best be under 36hrs per
job. These limitations have been reflected by the <code class="highlighter-rouge">max_*</code> values in
the configuration.</p>

<p>There are also 2 “derived” queues: <code class="highlighter-rouge">stephenslab</code> is a special
partition on <code class="highlighter-rouge">midway2</code> that allows for different configurations, thus
it is derived from <code class="highlighter-rouge">midway2</code> via <code class="highlighter-rouge">based_on: midway2</code>. Also relevant is
the <code class="highlighter-rouge">faraway2</code>, also <code class="highlighter-rouge">based_on: midway2</code>, but specifies the address of
how to connect to <code class="highlighter-rouge">midway2</code>. Then DSC will assume that the request is
made from a local computer and try to use the “local-host” mechanism
to run jobs.</p>

<p>The section <code class="highlighter-rouge">default</code> is also required. It provides default settings
for all modules in the DSC. Available settings are:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">queue</code>: name of the queue on the remote host to use, one of the
various queues defined in <code class="highlighter-rouge">DSC</code> section.</p>

    <ul>
      <li>Here in the template it is set to <code class="highlighter-rouge">midway2</code>, which is a “On-Host” queue.</li>
      <li><code class="highlighter-rouge">&lt;queue&gt;.local</code> is convention to execute locally without submitting to PBS.</li>
    </ul>
  </li>
  <li>
    <p><code class="highlighter-rouge">time_per_instance</code>: maximum computation time for each module
instance.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">instances_per_job</code>: the maximum number of module outputs that each 
job should should attempt to generate. This is useful 
consolidating numerous light-weight module instances into one 
jobs submission. If the DSC
contains long-running modules, this number should be made smaller,
otherwise each job will take a long time to complete. For modules
that run very quickly, <code class="highlighter-rouge">instances_per_job</code> should be set to a large
number to avoid overloading the job management system on a shared
computing environment.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">nodes_per_job</code>: this will utilize multi-node processing via the MPI 
interface so that each job is capable of running on multiple nodes to 
further parallel all module instances.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">cpus_per_node</code>: on each node, how many CPUs to use to parallel module
instances.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">cpus_per_instance</code>: how many CPUs to use for each module instance. This</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">mem_per_instance</code>: maximum memory used for each module instance.</p>
  </li>
</ul>

<p>For example for 100 module instances of <code class="highlighter-rouge">simulate</code> that each generates
some data in under a minute, one can specify <code class="highlighter-rouge">time_per_instance: 1m</code>
and <code class="highlighter-rouge">instance_per_job: 200</code>. Then a single job containing 200
simulations will be submitted to the host with a total of 200 minutes
computation time reserved.</p>

<p>Typically, <code class="highlighter-rouge">DSC</code> and <code class="highlighter-rouge">default</code> section for host configuration do not
have to be changed for different projects. Users can carefully
configure them once, and reuse for various projects. For Stephens Lab
users for example, one can take the example from above and configure 
resources for their DSC modules (sections after <code class="highlighter-rouge">default</code>).</p>

<p>In our example, under the folder <code class="highlighter-rouge">vignettes/one_sample_location</code> you
should find a file called <code class="highlighter-rouge">midway.yml</code> as described above. You can
open it with a text editor (on a cluster use <code class="highlighter-rouge">nano</code> from the terminal
for example), edit it to suit your project, and save it.</p>

<p><em>Please do not use this template without configuring the required
resources, particularly <code class="highlighter-rouge">time_per_instance</code> and
<code class="highlighter-rouge">instance_per_job</code>. They should be tailored for your project. In
proper configuration of these settings will lead to running many
small jobs (too low on <code class="highlighter-rouge">instance_per_job</code>) and waste of resource (too
high on <code class="highlighter-rouge">time_per_instance</code>).</em></p>

<h2 id="run-remote-jobs">Run remote jobs</h2>

<p>If the <code class="highlighter-rouge">default</code> queue is a “On-Host” queue (<code class="highlighter-rouge">address: localhost</code>), then</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsc ... <span class="nt">--host</span> /path/to/config.yml
</code></pre></div></div>

<p>will configuration in <code class="highlighter-rouge">/path/to/config.yml</code> and submit jobs.</p>

<p>For the “Local-Host” mechanism (<code class="highlighter-rouge">default::address: &lt;some URL&gt;</code>),</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsc ... <span class="nt">--host</span> /path/to/config.yml <span class="nt">--to-host</span> file1 dir1 file2
</code></pre></div></div>

<p>will additionally use <code class="highlighter-rouge">--to-host</code> to sync specified files and folders
to the remote, if the particular benchmark requires these files and
folders to execute (eg, data resource, shell executables, or scripts
in <code class="highlighter-rouge">DSC::lib_path</code>).</p>

<p>Caution that to successfully use <code class="highlighter-rouge">--to-host</code>, the command program
<a href="https://rsync.samba.org"><code class="highlighter-rouge">rsync</code></a> have to be available from the local
computer.</p>

<p>In our example, under the same folder
(“/dsc/vignettes/one_sample_location”), we run</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsc first_investigation_simpler.dsc <span class="nt">--host</span> midway.yml
</code></pre></div></div>

<h2 id="monitor-and-manage-jobs">Monitor and manage jobs</h2>

<p>When jobs are submitted, you should see on the screen something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: M1_9056f36343b32614 submitted to midway2 with job id 59250575
</code></pre></div></div>

<p>So there is a task ID <code class="highlighter-rouge">M1_9056f36343b32614</code> and job ID <code class="highlighter-rouge">59250575</code>. This can also be observed from your system’s job queue, for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          59250575   broadwl M1_9056f kaiqianz  R       0:04      1 midway2-0003
          59250576   broadwl M1_10b92 kaiqianz  R       0:04      1 midway2-0003
</code></pre></div></div>

<p>To check on one of the job, for example the first one:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sos status M1_9056f <span class="nt">-v3</span>
</code></pre></div></div>

<p>You will see information such as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M1_9056f36343b32614	56ed1083fa5bd015 normal normal_normal_1	
Created 20 hr ago	Started 2 min ago	Ran for 1 sec 	
completed
</code></pre></div></div>

<p>This means that the job comes from the module <code class="highlighter-rouge">normal</code> and produces 1 file <code class="highlighter-rouge">normal/normal_1</code>. There are also some other useful info on execution stats such as memory usage.</p>

<p>To have more details,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sos status M1_9056f <span class="nt">-v4</span>
</code></pre></div></div>

<p>and the output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M1_9056f36343b32614	completed

Created 21 hr ago
Started 6 min ago
Ran for 1 sec
TASK:
=====

TAGS:
=====
56ed1083fa5bd015 normal normal_normal_1

ENVIRONMENT:
============
_runtime              {'cores': 1,
 'cur_dir': '/home/kaiqianz/dsc/vignettes/one_sample_location',
 'home_dir': '/home/kaiqianz',
 'mem': 2000000000,
 'run_mode': 'run',
 'sig_mode': 'default',
 'verbosity': 2,
 'walltime': '00:03:00'}
step_name             'normal'

execution script:
================
#!/bin/bash
#SBATCH --time=00:03:00
#SBATCH --partition=broadwl
#
#SBATCH --nodes=1
#SBATCH --cpus-per-task=1
#SBATCH --mem=2G
#SBATCH --job-name=M1_9056f36343b32614
#SBATCH --output=/home/kaiqianz/dsc/vignettes/one_sample_location/M1_9056f36343b32614.out
#SBATCH --error=/home/kaiqianz/dsc/vignettes/one_sample_location/M1_9056f36343b32614.err
cd /home/kaiqianz/dsc/vignettes/one_sample_location
module load R
sos execute M1_9056f36343b32614 -v 2 -s default
standout output:
================
9056f36343b32614: completed
output: first_investigation/normal/normal_1.rds

standout error:
================
9056f36343b32614: completed
</code></pre></div></div>

<p>You will see the actual SBATCH script submitted. Of perticular interest is perhaps the <code class="highlighter-rouge">.err</code> and <code class="highlighter-rouge">.out</code>. They record screen output of a job. To check them out:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /home/kaiqianz/dsc/vignettes/one_sample_location/M1_9056f36343b32614.err
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Note that the current default version of R is 3.5.1.
INFO: M1_9056f36343b32614 started
INFO: All 1 tasks in M1_9056f36343b32614 completed
</code></pre></div></div>

<p>So here are three lines of messages related to loading R modules and nothing else. This is perhaps a good sign that no error or warning messages were generated from R-based jobs.</p>

<h2 id="computer-resource-overhead">Computer resource overhead</h2>

<p>DSC keeps track of jobs submitted to compute nodes on the computer you
submit the jobs from. This is some resource “overhead” one has to pay
for to run DSC on cluster. While it is convenient and tempting to run
directly from the head node, we recommend to submit this DSC command
as a job itself to a compute node. Or, to open up an interactive
session on a compute node and run from there.</p>

<p>The number of CPUs you ask for running the DSC submitter command
should match the <code class="highlighter-rouge">dsc ... -c</code> option. You can check the default
setting for <code class="highlighter-rouge">-c</code> by running <code class="highlighter-rouge">dsc -h</code> and look for documentation on
<code class="highlighter-rouge">-c</code> to find out the default (because the default depends on the
machine you run it from). We recommand requesting a compute node for 4
CPUs each with 2GB memory allocated. Then submit with <code class="highlighter-rouge">-c 4</code>.</p>


              <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/dsc-wiki/advanced_course/Rmd_Executable">
      〈 <span class="u-margin-right-tiny"></span> Using Rmd files as module executables
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/dsc-wiki/advanced_course/DSC_Docker">
      Running DSC in Docker <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

            </div>
          </div>
        </div>
      </main>
    </div>

  </body>
</html>
