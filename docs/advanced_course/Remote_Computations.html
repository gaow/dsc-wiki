<!DOCTYPE html>
<html lang="en">
  

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Running DSC on remote computers</title>
  <meta name="description" content="Running DSC on a remote computer">

  <link rel="canonical" href="https://stephenslab.github.io/dsc-wiki/advanced_course/Remote_Computations.html">
  <link rel="alternate" type="application/rss+xml" title="DSC" href="https://stephenslab.github.io/dsc-wiki/feed.xml">

  <meta property="og:url"         content="https://stephenslab.github.io/dsc-wiki/advanced_course/Remote_Computations.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Running DSC on remote computers" />
<meta property="og:description" content="Running DSC on a remote computer" />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "https://stephenslab.github.io/dsc-wiki/advanced_course/Remote_Computations.html",
  "headline":
    "Running DSC on remote computers",
  "datePublished":
    "2019-03-20T12:11:14-05:00",
  "dateModified":
    "2019-03-20T12:11:14-05:00",
  "description":
    "Running DSC on a remote computer",
  "author": {
    "@type": "Person",
    "name": "Stephens Lab, University of Chicago"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "https://stephenslab.github.io/dsc-wiki",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://stephenslab.github.io/dsc-wiki",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/dsc-wiki/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/dsc-wiki/images/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

// Helper function to init things quickly
initFunction = function(myfunc) {
  runWhenDOMLoaded(myfunc);
  document.addEventListener('turbolinks:load', myfunc);
};
</script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/dsc-wiki';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="/dsc-wiki/assets/js/anchor.min.js"  type="text/javascript"></script>
  <script>

initFunction(function () {
    anchors.add("main h1, main h2, main h3, main h4")
});

</script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/dsc-wiki/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  <script src="https://unpkg.com/nbinteract-core" async></script>

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->


  <!-- Google analytics -->
  <script src="/dsc-wiki/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load JS that depends on site variables -->
  <script>
/**
 * Set up copy/paste for code blocks
 */
const codeCellId = index => `codecell${index}`

const clipboardButton = id =>
  `<a class="btn copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#${id}">
    <img src="/dsc-wiki/assets/images/copy-button.svg" alt="Copy to clipboard">
  </a>`

// Clears selected text since ClipboardJS will select the text when copying
const clearSelection = () => {
  if (window.getSelection) {
    window.getSelection().removeAllRanges()
  } else if (document.selection) {
    document.selection.empty()
  }
}

// Changes tooltip text for two seconds, then changes it back
const temporarilyChangeTooltip = (el, newText) => {
  const oldText = el.getAttribute('data-tooltip')
  el.setAttribute('data-tooltip', newText)
  setTimeout(() => el.setAttribute('data-tooltip', oldText), 2000)
}

const addCopyButtonToCodeCells = () => {
  // If ClipboardJS hasn't loaded, wait a bit and try again. This
  // happens because we load ClipboardJS asynchronously.
  if (window.ClipboardJS === undefined) {
    setTimeout(addCopyButtonToCodeCells, 250)
    return
  }

  const codeCells = document.querySelectorAll('div.highlighter-rouge:not(.output) pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.querySelector(`pre#${id} + a`) == null) {
      codeCell.insertAdjacentHTML('afterend', clipboardButton(id));
    }
  })

  const clipboard = new ClipboardJS('.copybtn')
  clipboard.on('success', event => {
    clearSelection()
    temporarilyChangeTooltip(event.trigger, 'Copied!')
  })

  clipboard.on('error', event => {
    temporarilyChangeTooltip(event.trigger, 'Failed to copy')
  })

  // Get rid of clipboard before the next page visit to avoid memory leak
  document.addEventListener('turbolinks:before-visit', () =>
    clipboard.destroy()
  )
}

initFunction(addCopyButtonToCodeCells);
</script>

  <!-- Hide cell code -->
  
<script>
/**
Add buttons to hide code cells
*/


var setCodeCellVisibility = function(inputField, kind) {
    // Update the image and class for hidden
    var id = inputField.getAttribute('data-id');
    var codeCell = document.querySelector(`#${id}`);

    if (kind === "visible") {
        codeCell.classList.remove('hidden');
        inputField.checked = true;
    } else {
        codeCell.classList.add('hidden');
        inputField.checked = false;
    }
}

var toggleCodeCellVisibility = function (event) {
    // The label is clicked, and now we decide what to do based on the input field's clicked status
    if (event.target.tagName === "LABEL") {
        var inputField = event.target.previousElementSibling;
    } else {
        // It is the span inside the target
        var inputField = event.target.parentElement.previousElementSibling;
    }

    if (inputField.checked === true) {
        setCodeCellVisibility(inputField, "visible");
    } else {
        setCodeCellVisibility(inputField, "hidden");
    }
}


// Button constructor
const hideCodeButton = id => `<input class="hidebtn" type="checkbox" id="hidebtn${id}" data-id="${id}"><label title="Toggle cell" for="hidebtn${id}" class="plusminus"><span class="pm_h"></span><span class="pm_v"></span></label>`

var addHideButton = function () {
  // If a hide button is already added, don't add another
  if (document.querySelector('div.hidecode input') !== null) {
      return;
  }

  // Find the input cells and add a hide button
  document.querySelectorAll('div.input_area div.highlight').forEach(function (item, index) {
    if (!item.parentElement.classList.contains("hidecode")) {
        // Skip the cell if it doesn't have a hidecode class
        return;
    }

    const id = codeCellId(index)
    item.setAttribute('id', id);
    item.insertAdjacentHTML('afterend', hideCodeButton(id))

    // Set up the visibility toggle
    hideLink = document.querySelector(`#${id} + input + label`);
    hideLink.addEventListener('click', toggleCodeCellVisibility)
  });
}


// Initialize the hide buttos
var initHiddenCells = function () {
    // Add hide buttons to the cells
    addHideButton();

    // Toggle the code cells that should be hidden
    document.querySelectorAll('div.hidecode input').forEach(function (item) {
        setCodeCellVisibility(item, 'hidden');
        item.checked = true;
    })
}

initFunction(initHiddenCells);

</script>


  <!-- Load custom website scripts -->
  <script src="/dsc-wiki/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/dsc-wiki/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/dsc-wiki/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  

  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="/dsc-wiki/assets/js/lunr/lunr.min.js" type="text/javascript"></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>
</head>

  <body>
    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://github.com/stephenslab/dsc"><img src="/dsc-wiki/images/logo.png" class="textbook_logo" id="sidebar-logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">DSC</h2>
  <ul class="c-sidebar__chapters">
    
      
      
        <li class="c-sidebar__chapter"><a class="c-sidebar__entry" href="/dsc-wiki/search.html"><img src="/dsc-wiki/images/search.svg" alt="Search This Wiki"></a></li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/overview.html"
        >
          
          Home
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/installation.html"
        >
          
          Installation
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/faq.html"
        >
          
          FAQ
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/reference/reference.html"
        >
          
          Reference manual
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Terminology.html"
                >
                  
                  Terminology
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/DSC_Configuration.html"
                >
                  
                  DSC configuration syntax
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/DSC_Execution.html"
                >
                  
                  Running DSC
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/DSC_Filtering.html"
                >
                  
                  Extracting DSC results
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Command_Options.html"
                >
                  
                  Command-line reference
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Road_Map.html"
                >
                  
                  Development roadmap
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Implementation_Details.html"
                >
                  
                  Implementation details
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/reference/Unsupported_Features.html"
                >
                  
                  Unsupported features
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      
        <li class="c-sidebar__divider"></li>
        
      
      
        <li><h2 class="c-sidebar__title">User guide</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/first_course/first_course.html"
        >
          
          First course on DSC
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Intro_DSC.html"
                >
                  
                  A brief introduction to DSC
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Intro_Syntax_I.html"
                >
                  
                  DSC basics, part I
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Intro_Syntax_II.html"
                >
                  
                  DSC basics, part II
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Prototype_Tips.html"
                >
                  
                  Developing benchmarks
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Debug_Tips.html"
                >
                  
                  Debug in DSC
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/first_course/Syntax_Tips.html"
                >
                  
                  Syntax tips
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/faq.html"
        >
          
          Other tutorials
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/5_Minutes_Python.html"
                >
                  
                  Working with Python
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/DSC_Data.html"
                >
                  
                  DSC data flow
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/5_Minutes_RPY.html"
                >
                  
                  Working with R and Python
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/Multiple_Pipelines.html"
                >
                  
                  Running multiple pipelines
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/Rmd_Executable.html"
                >
                  
                  Using Rmd files as module executables
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry c-sidebar__entry--active"
                  href="/dsc-wiki/advanced_course/Remote_Computations.html"
                >
                  
                  Running DSC on remote computers
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/advanced_course/DSC_Docker.html"
                >
                  
                  Running DSC in Docker
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsc-wiki/examples.html"
        >
          
          Benchmark examples
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/examples/R_Example_1.html"
                >
                  
                  R Example 1
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsc-wiki/examples/R_Example_2.html"
                >
                  
                  R Example 2
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
  </ul>
  <p class="sidebar_footer">Copyright (c) 2016-2018 <br> <a href="http://home.uchicago.edu/gaow">Gao Wang</a>, <a href="http://stephenslab.uchicago.edu">Matthew Stephens</a>, <a href="https://pcarbo.github.io">Peter Carbonetto</a> and contributors.<br></p>
</nav>

      
      <!-- Shamelessly copied from minimal mistakes -->


<!-- TOC will only show up if it has at least one item -->


  <aside class="sidebar__right">
    <nav class="onthispage">
      <header><h4 class="nav__title"><i class="fa fa-list"></i>   Contents</h4></header>
      <ul class="toc__menu">
  <li><a href="#overview">Overview</a></li>
  <li><a href="#job-configuration-template-and-command-options">Job configuration template and command options</a></li>
  <li><a href="#host-configuration-example">Host configuration example</a></li>
  <li><a href="#control-number-of-jobs-to-submit">Control number of jobs to submit</a></li>
  <li><a href="#run-remote-jobs">Run remote jobs</a></li>
  <li><a href="#monitor-and-manage-jobs">Monitor and manage jobs</a></li>
</ul>
    </nav>
  </aside>


      
      <main class="c-textbook__page" tabindex="-1">
          <div class="o-wrapper">
            <div class="c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

            

            <div class="c-textbook__content">
              <h1 id="running-dsc-on-a-remote-computer">Running DSC on a remote computer</h1>

<h2 id="overview">Overview</h2>

<p>DSC uses one additional configuration file and two command options (<code class="highlighter-rouge">--host</code> and <code class="highlighter-rouge">--to-host</code>) to run on a remote computer (or “host”, hereafter). Here a remote computer can be:</p>

<ol>
  <li>A standalone desktop workstation without a job queue system</li>
  <li>A system with a job queue manager, such as PBS-based cluster</li>
</ol>

<p>DSC facilicate two approaches to run remote tasks:</p>

<ol>
  <li>“On-Host”, the conventional way: log in to the host and run remote jobs. For a standalone system, this is no difference from logging in to the system and run DSC benchmark directly. For a cluster system this will automatically submit jobs to compute nodes based on provided template.</li>
  <li>“Local-Host”, a host friendly way: do not log in to the host to run jobs. Rather, have a copy of DSC software installed to your local computer (Mac or Linux), and configure the host to have DSC and all required tools for benchmarking installed. Then run DSC from local computer with additional folders to be synced to the host specified by <code class="highlighter-rouge">--to-host</code> option. The local computer will serve as the job dispatcher and job monitor. This provides a way to run on hosts that has some policy constraints on long running jobs from the headnode, for example.</li>
</ol>

<p>Under the hood, DSC configures all modules and converts them to <a href="https://vatlab.github.io/sos-docs"><code class="highlighter-rouge">SoS</code></a> tasks. Enthusiastic readers shall refer to <a href="https://vatlab.github.io/sos-docs/doc/documentation/Remote_Execution.html">this page</a> for details under the hood. Configuration here in DSC is further automated for benchmarking and thus simpler interface-wise.</p>

<p>In this tutorial we’ll focus on discussing running jobs on a cluster with queue manager.</p>

<h2 id="job-configuration-template-and-command-options">Job configuration template and command options</h2>

<p>Using a template and command options, DSC allows users to:</p>

<ol>
  <li>Configure job submission on host.</li>
  <li>Configure resource requirement per module.</li>
</ol>

<p>Using command options, users can</p>

<ol>
  <li>Submit the entire benchmark with controlled maximum job limits (command option <code class="highlighter-rouge">-c</code>).</li>
  <li>When submitting from local to host computer, automatically send required files to the host for benchmarking (command option <code class="highlighter-rouge">--to-host</code>).</li>
</ol>

<p>Users can also use SoS utility tools to manage jobs. The end of documentation will briefly discuss a few SoS utility commands with examples.</p>

<h2 id="host-configuration-example">Host configuration example</h2>

<p>DSC command option <code class="highlighter-rouge">--host</code> accepts a YAML configuration file that specifies a <em>template</em> for remote jobs. <strong>We provide support to such configuration files on need-basis</strong>, because we (the DSC developers) can only verify and ensure the it works on system that we have access to and use on regular basis. For example, <a href="https://github.com/stephenslab/dsc-reg/blob/master/midway.yml">here is a template</a> for a system running PBS type of queue via Slurm Workload Manage:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">DSC</span><span class="pi">:</span>
  <span class="na">midway2</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">UChicago RCC cluster Midway 2</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">paths</span><span class="pi">:</span>
      <span class="na">home</span><span class="pi">:</span> <span class="s">/home/gaow</span>
    <span class="na">queue_type</span><span class="pi">:</span> <span class="s">pbs</span>
    <span class="na">status_check_interval</span><span class="pi">:</span> <span class="s">60</span>
    <span class="na">max_running_jobs</span><span class="pi">:</span> <span class="s">40</span>
    <span class="na">max_cores</span><span class="pi">:</span> <span class="s">40</span>
    <span class="na">max_walltime</span><span class="pi">:</span> <span class="s2">"</span><span class="s">36:00:00"</span>
    <span class="na">max_mem</span><span class="pi">:</span> <span class="s">64G</span>
    <span class="na">job_template</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">#!/bin/bash</span>
      <span class="no">#SBATCH --time={walltime}</span>
      <span class="no">#{partition}</span>
      <span class="no">#{account}</span>
      <span class="no">#SBATCH --nodes=1</span>
      <span class="no">#SBATCH --ntasks-per-node={cores}</span>
      <span class="no">#SBATCH --mem-per-cpu={mem//10**9}G</span>
      <span class="no">#SBATCH --job-name={job_name}</span>
      <span class="no">#SBATCH --output={cur_dir}/{job_name}.stdout</span>
      <span class="no">#SBATCH --error={cur_dir}/{job_name}.stderr</span>
      <span class="no">cd {cur_dir}</span>
      <span class="no">module load R/3.4.3</span>
    <span class="na">partition</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SBATCH</span><span class="nv"> </span><span class="s">--partition=broadwl"</span>
    <span class="na">account</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">submit_cmd</span><span class="pi">:</span> <span class="s">sbatch {job_file}</span>
    <span class="na">submit_cmd_output</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Submitted</span><span class="nv"> </span><span class="s">batch</span><span class="nv"> </span><span class="s">job</span><span class="nv"> </span><span class="s">{job_id}"</span>
    <span class="na">status_cmd</span><span class="pi">:</span> <span class="s">squeue --job {job_id}</span>
    <span class="na">kill_cmd</span><span class="pi">:</span> <span class="s">scancel {job_id}</span>
  <span class="na">faraway2</span><span class="pi">:</span>
    <span class="na">based_on</span><span class="pi">:</span> <span class="s">midway2</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Submit and manage jobs to `midway2` from a local computer.</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">gaow@midway2.rcc.uchicago.edu</span>
  <span class="na">stephenslab</span><span class="pi">:</span>
    <span class="na">based_on</span><span class="pi">:</span> <span class="s">midway2</span>
    <span class="na">max_cores</span><span class="pi">:</span> <span class="s">28</span>
    <span class="na">max_mem</span><span class="pi">:</span> <span class="s">128G</span>
    <span class="na">max_walltime</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10d"</span>
    <span class="na">partition</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SBATCH</span><span class="nv"> </span><span class="s">--partition=mstephens"</span>
    <span class="na">account</span><span class="pi">:</span> <span class="s2">"</span><span class="s">SBATCH</span><span class="nv"> </span><span class="s">--account=pi-mstephens"</span>

<span class="na">default</span><span class="pi">:</span>
  <span class="na">queue</span><span class="pi">:</span> <span class="s">midway2</span>
  <span class="na">time_per_instance</span><span class="pi">:</span> <span class="s">10m</span>
  <span class="na">instances_per_job</span><span class="pi">:</span> <span class="s">2</span>
  <span class="na">n_cpu</span><span class="pi">:</span> <span class="s">1</span>
  <span class="na">mem_per_cpu</span><span class="pi">:</span> <span class="s">2G</span>

<span class="c1"># module specific configurations</span>
<span class="c1"># mostly to consolidate small jobs</span>
<span class="na">simulate</span><span class="pi">:</span>
  <span class="na">instances_per_job</span><span class="pi">:</span> <span class="s">20</span>

<span class="na">score</span><span class="pi">:</span>
  <span class="na">instances_per_job</span><span class="pi">:</span> <span class="s">20</span>
</code></pre></div></div>

<p>The section <code class="highlighter-rouge">DSC</code> is required to provide various templates for a number of systems. Here <code class="highlighter-rouge">midway2</code> is a host provided by <a href="https://rcc.uchicago.edu">The University of Chicago RCC group</a>. Jobs are submitted to <code class="highlighter-rouge">partition=broadwl</code>. Typically it has 40 cores per node, allows for maximum of 40 concurrent jobs per user, and a maximum running time of 36hrs per job. These limitations have been reflected by the <code class="highlighter-rouge">max_*</code> values in the configuration.</p>

<p>There are also 2 “derived” queue: <code class="highlighter-rouge">stephenslab</code> is a special partition on <code class="highlighter-rouge">midway2</code> that allows for different configurations, thus it is derived from <code class="highlighter-rouge">midway2</code> via <code class="highlighter-rouge">based_on: midway2</code>. Also relevant is the <code class="highlighter-rouge">faraway2</code>, also <code class="highlighter-rouge">based_on: midway2</code>, but specifies the address of how to connect to <code class="highlighter-rouge">midway2</code>. Then DSC will assume that the request is made from a local computer and try to use the “local-host” mechanism to run jobs.</p>

<p>The section <code class="highlighter-rouge">default</code> is also required. It provides default settings for all modules in the DSC. Available settings are:</p>

<ul>
  <li><code class="highlighter-rouge">queue</code>: name of the queue on the remote host to use, one of the various queues defined in <code class="highlighter-rouge">DSC</code> section.
    <ul>
      <li>Here in the template it is set to <code class="highlighter-rouge">midway2</code>, which is a “On-Host” queue.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">time_per_instance</code>: maximum computation time for each module instance.</li>
  <li><code class="highlighter-rouge">instance_per_job</code>: how many module instances to submit as one remote job. This is useful consolidating numerous light-weight module instances into one jobs submission.</li>
  <li><code class="highlighter-rouge">n_cpu</code> and <code class="highlighter-rouge">mem_per_cpu</code> specify the CPU and memory requirement of a module instance.</li>
</ul>

<p>For example for 100 module instances of <code class="highlighter-rouge">simulate</code> that each generates some data in under a minute, one can specify <code class="highlighter-rouge">time_per_instance: 1m</code> and <code class="highlighter-rouge">instance_per_job: 200</code>. Then a single job containing 200 simulations will be submitted to the host with a total of 200 minutes computation time reserved.</p>

<p>Typically, <code class="highlighter-rouge">DSC</code> and <code class="highlighter-rouge">default</code> section for host configuration do not have to be changed for different projects. Users can carefully configure them once, and reuse for various projects. For Stephens Lab users for example, one can take the example from above and replace <code class="highlighter-rouge">gaow</code> with their UChicago cnetID.</p>

<p><strong>Please never use this template without configuring the required resources, particularly <code class="highlighter-rouge">time_per_instance</code> and <code class="highlighter-rouge">instance_per_job</code>. They should be tailored for your project. In proper configuration of these settings will lead to running many small jobs (too low on <code class="highlighter-rouge">instance_per_job</code>) and waste of resource (too high on <code class="highlighter-rouge">time_per_instance</code>)</strong></p>

<h2 id="control-number-of-jobs-to-submit">Control number of jobs to submit</h2>

<p>In the configuration file, <code class="highlighter-rouge">max_running_jobs</code> confines the maximum number of jobs to run on the host. This is set to have a safe limit that prevents from harming the host sytem (and getting angry system emails). For each benchmark submitted, the command option <code class="highlighter-rouge">-c</code> should be used to customize the maximum number of jobs to have in the queue. Command <code class="highlighter-rouge">dsc -h</code> will show you the default value of this number. Since it is a shared command option with running jobs locally, the default is set to ~1/2 of the total available CPU threads on the computer that executes <code class="highlighter-rouge">dsc</code>. That is, for the “On-Host” submission the default number of jobs will be half of threads on the head node; for the “Local-Host” submission the default will be half of threads on a local computer, which can be quite small when running from, say, a regular laptop. It is thus advised to always specify <code class="highlighter-rouge">-c</code> option.</p>

<h2 id="run-remote-jobs">Run remote jobs</h2>

<p>If the <code class="highlighter-rouge">default</code> queue is a “On-Host” queue (<code class="highlighter-rouge">address: localhost</code>), then</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsc ... <span class="nt">--host</span> /path/to/config.yml <span class="nt">-c</span> 30
</code></pre></div></div>

<p>will configuration in <code class="highlighter-rouge">/path/to/config.yml</code> and submit jobs, in batches of 30.</p>

<p>For the “Local-Host” mechanism (<code class="highlighter-rouge">default::address: &lt;some URL&gt;</code>),</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsc ... <span class="nt">--host</span> /path/to/config.yml <span class="nt">--to-host</span> file1 dir1 file2 <span class="nt">-c</span> 30
</code></pre></div></div>

<p>will additionally use <code class="highlighter-rouge">--to-host</code> to sync specified files and folders to the remote, if the particular benchmark requires these files and folders to execute (eg, data resource, shell executables, or scripts in <code class="highlighter-rouge">DSC::lib_path</code>).</p>

<p>Caution that to successfully use <code class="highlighter-rouge">--to-host</code>, the command program <a href="https://rsync.samba.org"><code class="highlighter-rouge">rsync</code></a> have to be available from the local computer.</p>

<h2 id="monitor-and-manage-jobs">Monitor and manage jobs</h2>

<p>When jobs are submitted, you should see on the screen something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: M2_9eb9ad957cc31d50 submitted to midway2 with job id 45634260
</code></pre></div></div>

<p>So there is a task ID <code class="highlighter-rouge">M2_9eb9ad957cc31d50</code> and job ID <code class="highlighter-rouge">45634260</code>. This can also be observed from your system’s job queue, for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          45633096   broadwl M2_2eac6     gaow PD       0:00      1 (Priority)
          45633098   broadwl M2_c6ed0     gaow PD       0:00      1 (Priority)
          45633099   broadwl M2_38e36     gaow PD       0:00      1 (Priority)
          45633100   broadwl M2_8fea7     gaow PD       0:00      1 (Priority)
          45633101   broadwl M2_829d4     gaow PD       0:00      1 (Priority)
          45633102   broadwl M2_3ab21     gaow PD       0:00      1 (Priority)
          45633103   broadwl M2_ed42e     gaow PD       0:00      1 (Priority)
          45633104   broadwl M2_2966b     gaow PD       0:00      1 (Priority)
          45633086   broadwl M2_13151     gaow  R       0:01      1 midway2-0033
          45633087   broadwl M2_01df1     gaow  R       0:01      1 midway2-0033
          45633088   broadwl M2_b8668     gaow  R       0:01      1 midway2-0033
          45633089   broadwl M2_89a83     gaow  R       0:01      1 midway2-0070
          45633090   broadwl M2_7cbdd     gaow  R       0:01      1 midway2-0070
          45633091   broadwl M2_56fa6     gaow  R       0:01      1 midway2-0070
          45633092   broadwl M2_4baac     gaow  R       0:01      1 midway2-0070
</code></pre></div></div>

<p>To check on one of the job, for example the first one:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sos status M2_2eac6 <span class="nt">-v3</span>
</code></pre></div></div>

<p>You will see information such as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Started 27 min 13 sec ago
Duration 26 min 59 sec

TAGS:
=====
e0b204d49b525c52 susie2_0 susie2_sparse_13_susie2_1 susie2_sparse_14_susie2_1

...
</code></pre></div></div>

<p>The <code class="highlighter-rouge">TAGS</code> line explains that the job comes from the module <code class="highlighter-rouge">susie2</code> and produces 2 files <code class="highlighter-rouge">susie2/sparse_13_susie2_1</code> and  <code class="highlighter-rouge">susie2/sparse_14_susie2_1</code>. That is, 2 module instances per job. There are also some other useful info on execution stats such as memory usage.</p>

<p>To have more details,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sos status M2_2eac6 <span class="nt">-v4</span>
</code></pre></div></div>

<p>and the output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M2_2eac66b84134d3f8.err:
========================
2eac66b84134d3f8: completed
2018-05-02 07:49:50,749: DEBUG: 2eac66b84134d3f8 ``started``
2018-05-02 07:49:51,249: DEBUG: 2eac66b84134d3f8 ``completed``
c9afa00936023dba: completed
2018-05-02 07:49:51,299: DEBUG: c9afa00936023dba ``started``
2018-05-02 07:49:51,788: DEBUG: c9afa00936023dba ``completed``

M2_2eac66b84134d3f8.out:
========================
2eac66b84134d3f8: completed
output: {file_target('benchmark/susie2/sparse_13_susie2_1.rds'): '12e0ebc6506e00e2'}
c9afa00936023dba: completed
output: {file_target('benchmark/susie2/sparse_14_susie2_1.rds'): '98adf711379a200e'}

M2_2eac66b84134d3f8.sh:
=======================
#!/bin/bash
#SBATCH --time=00:10:00
#SBATCH --partition=broadwl

#SBATCH --nodes=1
#SBATCH --ntasks-per-node=3
#SBATCH --mem-per-cpu=4G
#SBATCH --job-name=M2_2eac66b84134d3f8
#SBATCH --output=/scratch/midway2/gaow/GIT/lab-dsc/dsc-reg/.sos/M2_2eac66b84134d3f8.stdout
#SBATCH --error=/scratch/midway2/gaow/GIT/lab-dsc/dsc-reg/.sos/M2_2eac66b84134d3f8.stderr
cd /scratch/midway2/gaow/GIT/lab-dsc/dsc-reg
module load R/3.4.3
sos execute M2_2eac66b84134d3f8 -v 2 -s default
</code></pre></div></div>

<p>You will see the actual SBATCH script submitted. Of perticular interest is perhaps the <code class="highlighter-rouge">stderr</code> and <code class="highlighter-rouge">stdout</code>. They record screen output of a job. To check them out:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /scratch/midway2/gaow/GIT/lab-dsc/dsc-reg/.sos/M2_2eac66b84134d3f8.err
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Note that the current default version of R is 3.4.3.
Type "module help R" for advice on using R on midway.
</code></pre></div></div>

<p>So I get two lines of messages related to loading R modules and nothing else. This is perhaps a good sign that no error or warning messages were generated from my R-based jobs.</p>

              <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/dsc-wiki/advanced_course/Rmd_Executable">
      〈 <span class="u-margin-right-tiny"></span> Using Rmd files as module executables
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/dsc-wiki/advanced_course/DSC_Docker">
      Running DSC in Docker <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

            </div>
          </div>
        </div>
      </main>
    </div>

  </body>
</html>
