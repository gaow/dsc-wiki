
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="ipynb_website:version" content="0.9.4" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="../css/jt.css">

<link rel="stylesheet" type="text/css" href="../css/toc2.css">

<link href="../site_libs/jqueryui-1.11.4/jquery-ui.css">
<link rel="stylesheet" href="../site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<link rel="stylesheet" href="../site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<link rel="stylesheet"
      href="../site_libs/highlightjs-1.1/textmate.css"
      type="text/css" />

<script src="../site_libs/highlightjs-1.1/highlight.js"></script>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>

<script src="../js/doc_toc.js"></script>
<script src="../js/docs.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": {
            preferredFont: "TeX",
            availableFonts: ["TeX"],
            styles: {
                scale: 110,
                ".MathJax_Display": {
                    "font-size": "110%",
                }
            }
        }
    });
</script>
<script>
function filterDataFrame(id) {
    var input = document.getElementById("search_" + id);
    var filter = input.value.toUpperCase();
    var table = document.getElementById("dataframe_" + id);
    var tr = table.getElementsByTagName("tr");
    // Loop through all table rows, and hide those who don't match the search query
    for (var i = 1; i < tr.length; i++) {
        for (var j = 0; j < tr[i].cells.length; ++j) {
            var matched = false;
            if (tr[i].cells[j].innerHTML.toUpperCase().indexOf(filter) != -1) {
                tr[i].style.display = "";
                matched = true
                break;
            }
            if (!matched)
                tr[i].style.display = "none";
        }
    }
}
function sortDataFrame(id, n, dtype) {
    var table = document.getElementById("dataframe_" + id);
    var tb = table.tBodies[0]; // use `<tbody>` to ignore `<thead>` and `<tfoot>` rows
    var tr = Array.prototype.slice.call(tb.rows, 0); // put rows into array
    if (dtype === 'numeric') {
        var fn = function(a, b) { 
            return parseFloat(a.cells[n].textContent) <= parseFloat(b.cells[n].textContent) ? -1 : 1;
        }
    } else {
        var fn = function(a, b) {
            var c = a.cells[n].textContent.trim().localeCompare(b.cells[n].textContent.trim()); 
            return c > 0 ? 1 : (c < 0 ? -1 : 0) }
    }
    var isSorted = function(array, fn) {
        if (array.length < 2)
            return 1;
        var direction = fn(array[0], array[1]); 
        for (var i = 1; i < array.length - 1; ++i) {
            var d = fn(array[i], array[i+1]);
            if (d == 0)
                continue;
            else if (direction == 0)
                direction = d;
            else if (direction != d)
                return 0;
            }
        return direction;
    }
    var sorted = isSorted(tr, fn);
    if (sorted == 1 || sorted == -1) {
        // if sorted already, reverse it
        for(var i = tr.length - 1; i >= 0; --i)
            tb.appendChild(tr[i]); // append each row in order
    } else {
        tr = tr.sort(fn);
        for(var i = 0; i < tr.length; ++i)
            tb.appendChild(tr[i]); // append each row in order
    }
}
</script>

<script>
$( document ).ready(function(){
            var cfg={'threshold':3,     // depth of toc (number of levels)
             'number_sections': false,
             'toc_cell': false,          // useless here
             'toc_window_display': true, // display the toc window
             "toc_section_display": "block", // display toc contents in the window
             'sideBar':true,       // sidebar or floating window
             'navigate_menu':false       // navigation menu (only in liveNotebook -- do not change)
            }
            var st={};                  // some variables used in the script
            st.rendering_toc_cell = false;
            st.config_loaded = false;
            st.extension_initialized=false;
            st.nbcontainer_marginleft = $('#notebook-container').css('margin-left')
            st.nbcontainer_marginright = $('#notebook-container').css('margin-right')
            st.nbcontainer_width = $('#notebook-container').css('width')
            st.oldTocHeight = undefined
            st.cell_toc = undefined;
            st.toc_index=0;
            // fire the main function with these parameters
            table_of_contents(cfg, st);
            var file=manualDict[$("h1:first").attr("id")];
            $("#toc-level0 a").css("color","#126dce");
            $('a[href="#'+$("h1:first").attr("id")+'"]').hide()
            var docs=manualArray;
            var docs_map=manualArrayMap;
            var pos=manualArray.indexOf(file);
            for (var a=pos;a>=0;a--){
                  $('<li><a href="'+docs[a]+'.html"><font color="#073642"><b>'+docs_map[docs[a]].replace(/_/g," ")+'</b></font></a></li>').insertBefore("#toc-level0 li:eq(0)");
            }
            $('a[href="'+file+'.html'+'"]').css("color","#126dce");
            for (var a=pos+1;a<docs.length;a++){
                  $(".toc #toc-level0").append('<li><a href="'+docs[a]+'.html"><font color="#073642"><b>'+docs_map[docs[a]].replace(/_/g," ")+'</b></font></a></li>');
            }
            // $("#toc-header").hide(); // comment out because it prevents search bar from displaying
    });
</script>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');
  // mark it active
  menuAnchor.parent().addClass('active');
  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>
<div class="container-fluid main-container">
<!-- tabsets -->
<script src="../site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>



<title>Dynamic Statistical Comparisons</title>

<style type = "text/css">
body {
  font-family: "Droid Sans";
  padding-top: 66px;
  padding-bottom: 40px;
}
</style>
</head>

<body>
<div tabindex="-1" id="notebook" class="border-box-sizing">
<div class="container" id="notebook-container">

<!-- code folding -->

<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Dynamic Statistical Comparisons</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
<li>
  <a href="../index.html">Home</a>
</li>
        
<li>
  <a href="../tutorials.html">Tutorials</a>
</li>
        
<li>
  <a href="../installation.html">Installation</a>
</li>
        
<li>
  <a href="../examples.html">Examples</a>
</li>
        
<li>
  <a href="../manual.html">Manual</a>
</li>
        
      </ul>
        
<ul class="nav navbar-nav navbar-right">
<li>
   <a href="https://github.com/stephenslab/dsc2"> <span class="fa fa-github"></span> </a>
</li>
</ul>
        
      </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="DSC-syntax:-basics-of-benchmark-execution">DSC syntax: basics of benchmark execution<a class="anchor-link" href="#DSC-syntax:-basics-of-benchmark-execution">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This document is continuation of discussion in <a href="DSC_Configuration.html">DSC syntax: basics of modules</a>. We will use toy DSC examples (including breaking down <a href="https://github.com/stephenslab/dsc/blob/master/vignettes/one_sample_location/settings.dsc">this toy</a>) to introduce a special syntax block called <code>DSC</code> that defines module ensembles, pipelines and DSC benchmark, as well as execution environment. This block has a reserved property keyword <code>DSC</code> and is required for all DSC scripts. In this document we refer to its contents by <code>DSC::&lt;key&gt;</code> where <code>&lt;key&gt;</code> is the identifier on the left side of <code>:</code> in each line of the <code>DSC</code> block.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Benchmark-logic-operators">Benchmark logic operators<a class="anchor-link" href="#Benchmark-logic-operators">&#182;</a></h2><p>In building a DSC benchmark, two logic are involved: "alternating" modules, or <em>module ensemble</em>, refers to groups of modules that achieve the same goal (able to take similar input and provide the same type of output) as if they are exchangable; "concatenating" modules, or <em>pipelines</em> refers to sequences of modules that executes one after another as if concatenated into a chain of actions. These logic are implemented via <code>*</code>, <code>,</code> and <code>()</code> operators:</p>
<ul>
<li><code>*</code>: connects concatenating modules, ie, right hand side (RHS) is executed after the left hand side (LHS).</li>
<li><code>,</code>: connects alternating modules, ie, RHS and LHS are exchangable.</li>
<li><code>()</code>: when alternating modules and concatenating modules are combined, it is used to re-define operator precedence. By default <code>*</code> has higher precedence than <code>,</code>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Module-ensembles-and-pipelines">Module ensembles and pipelines<a class="anchor-link" href="#Module-ensembles-and-pipelines">&#182;</a></h2><p><code>DSC::define</code> defines module ensembles and pipelines, that is, groups of "alternating" or sequences of "concatenating" modules / ensembles. For example:</p>

<pre><code>normal, t: rnorm.R, rt.R
    ...
mean, median: mean.R, median.R
    ...

DSC:
    define:
      simulate: normal, t
      estimate: mean, median</code></pre>
<p>Here 2 ensembles are defined: <code>simulate</code>, of alternating modules <code>normal</code> and <code>t</code> for data generation, and <code>estimate</code>, of alternating modules <code>mean</code> and <code>median</code> for parameter estimation.</p>
<p>To illustrate pipelines and pipeline ensemble we can add an additional <code>winsorize</code> module to <code>estimate</code>, creating a pipeline ensemble called <code>winsorized_estimate</code>:</p>

<pre><code>DSC:
    define:
      simulate: normal, t
      winsorized_estimate: winsorize * (mean, median)</code></pre>
<p><code>winsorized_estimate</code> pipeline ensemble contains 2 pipelines <code>winsorize * mean</code> and <code>winsorize * median</code>. They are not <em>full pipeline</em> because they depend on input from <code>simulate</code>. DSC benchmark <code>DSC::run</code> will require one or multiple full pipelines -- see below for detailed discussions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DSC-benchmark">DSC benchmark<a class="anchor-link" href="#DSC-benchmark">&#182;</a></h2><p>DSC benchmark, defined by <code>DSC::run</code>, is one or multiple complete pipelines. We will use a series of examples to illustrate how benchmarks are created.</p>
<h4 id="Example-1:-styles-of-pipeline-speicification">Example 1: styles of pipeline speicification<a class="anchor-link" href="#Example-1:-styles-of-pipeline-speicification">&#182;</a></h4>
<pre><code>run: simulate * estimate * score</code></pre>
<p>Here <code>simulate</code> and <code>estimate</code> are module ensembles (see <code>DSC::define</code> of previous section). This is equivalent to writing:</p>

<pre><code>run: (normal, t) * (mean, median) * score</code></pre>
<h4 id="Example-2:-concatenating-module-and-pipeline-ensembles">Example 2: concatenating module and pipeline ensembles<a class="anchor-link" href="#Example-2:-concatenating-module-and-pipeline-ensembles">&#182;</a></h4>
<pre><code>run: simulate * (winsorize * mean, mean) * score</code></pre>
<p>Here <code>simulate</code> is a module ensemble, <code>(winsorize * mean, mean)</code> is a pipeline ensemble and <code>score</code> is a module. DSC will run 2 flavors of pipelines: 1) that involves <code>winsorize</code> followed by <code>mean</code>, and 2) <code>mean</code> only.</p>
<h4 id="Example-3:-expansion-of-pipeline-operators">Example 3: expansion of pipeline operators<a class="anchor-link" href="#Example-3:-expansion-of-pipeline-operators">&#182;</a></h4>
<pre><code>run: simulate * (voom, sqrt, identity) * (RUV, SVA) * (DESeq, edgeRglm, ash) * score</code></pre>
<p>will be expanded to:</p>

<pre><code>run: simulate * sqrt * RUV * DESeq * score,
   simulate * sqrt * SVA * DESeq * score,
   simulate * identity * RUV * DESeq * score,
   simulate * voom * RUV * DESeq * score,
   simulate * identity * SVA * DESeq * score,
   simulate * voom * SVA * DESeq * score,
   simulate * sqrt * RUV * ash * score,
   simulate * sqrt * RUV * edgeRglm * score,
   simulate * sqrt * SVA * ash * score,
   simulate * sqrt * SVA * edgeRglm * score,
   simulate * identity * RUV * ash * score,
   simulate * voom * RUV * ash * score,
   simulate * identity * RUV * edgeRglm * score,
   simulate * voom * RUV * edgeRglm * score,
   simulate * identity * SVA * ash * score,
   simulate * voom * SVA * ash * score,
   simulate * identity * SVA * edgeRglm * score,
   simulate * voom * SVA * edgeRglm * score</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Command-interface-to-DSC-benchmark">Command interface to DSC benchmark<a class="anchor-link" href="#Command-interface-to-DSC-benchmark">&#182;</a></h2><p>By default, DSC will execute all pipelines defined in <code>DSC::run</code>. But one can override pipelines from <a href="Command_Options.html">command line</a>. For example to execute the complete <code>Example 1</code></p>

<pre><code>dsc file.dsc --target "simulate * estimate * score"</code></pre>
<p>or a subset of <code>Example 1</code>:</p>

<pre><code>dsc file.dsc --target "normal * estimate * score"</code></pre>
<p>You can also execute a single module / ensemble <strong>for debug purpose</strong>. Commands below are equivalent:</p>

<pre><code>dsc file.dsc --target normal t
dsc file.dsc --target simulate</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Benchmark-parameters">Benchmark parameters<a class="anchor-link" href="#Benchmark-parameters">&#182;</a></h2><p>These parameters are specified in the rest of <code>DSC</code> block:</p>
<ul>
<li><code>exec_path</code>: search path (or paths) for executable files</li>
<li><code>lib_path</code>: search path (or paths) for library files, such as R script to be <code>source</code>-ed or Python scripts to be <code>import</code>-ed from</li>
<li><code>R_libs</code>: check required R libraries and if not available, automatically install them from cran, bioconductor or github. 3 formats are accepted:<ul>
<li><code>&lt;package&gt;</code>: DSC will check / install <code>package</code> from cran or bioconductor.</li>
<li><code>&lt;package@github_repo/subdir&gt;</code>: DSC will install <code>package</code> from <code>github_repo</code> on github. <code>/subdir</code> is optional -- only applicable when the package is not in the root of the repository. eg <code>ashr@stephenslab/ashr</code>, <code>varbvs@pcarbo/varbvs/varbvs-r</code>.</li>
<li><code>&lt;package (version[s])&gt;</code>: DSC will install <code>package</code> and check version as required. A warning message will be generated if version do not match after force installation to the latest. It is possible to specify several versions such as <code>edgeR (3.12.0, 3.12.1)</code> or simply <code>edgeR (3.12.0+)</code>.</li>
</ul>
</li>
<li><code>python_modules</code>: check required Python3 modules, and install from pip if not available.</li>
<li><code>work_dir</code>: work directory where benchmarking will take place.</li>
<li><code>output</code>: folder name to store benchmark output files.</li>
<li><code>global</code>: defines global variables which can be used in definition of module parameters through <a href="DSC_Configuration.html#Variable-wildcard-131">variable wildcard</a> <code>$()</code>.</li>
<li><code>replicate</code>: number of replicate to run the benchmark (default is 1).</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Override-runtime-options-in-modules-with-@CONF">Override runtime options in modules with <code>@CONF</code><a class="anchor-link" href="#Override-runtime-options-in-modules-with-@CONF">&#182;</a></h3><p>Among these DSC runtime options, the following can be customized on per-module basis:</p>
<ul>
<li><code>exec_path</code>, <code>lib_path</code>, <code>work_dir</code>, <code>R_libs</code>, <code>python_modules</code></li>
</ul>
<p>The syntax is similar to that of <code>@ALIAS</code>. That is, values are assigned by <code>=</code>:</p>

<pre><code>simulate: simulate.R
    ...
    @CONF: exec_path = simulate_bin, lib_path = simulate_lib</code></pre>
<p>and can be module specific:</p>

<pre><code>normal, t: simulate.R
    ...
    @CONF:
        normal: exec_path = normal_bin
        t: exec_path = t_bin</code></pre>
<p>Multiple paths needs to be specified as a tuple, eg.</p>

<pre><code>simulate: simulate.R
    ...
    @CONF: lib_path = (simulate_lib, main_lib), R_libs = (ashr@stephenslab/ashr 2.2.7+, mashr 0.2.6+)</code></pre>
<p><code>@CONF</code> is designed not only to "fine-tune" the runtime environment of a module, but, as a "decorator", will change behavior of a module's execution. Specifically:</p>
<ul>
<li><code>lib_path</code> when specified under <code>@CONF</code>, all relevant scripts (of the same type as the executable, eg. <code>R</code> or <code>Py</code>) will be kept track of. Changes to their content will result in re-execution of all instances under this module when running the benchmark.</li>
<li><code>R_libs</code> when specified under <code>@CONF</code> will automatically load all listed libraries via <code>library(...)</code> prior to running the module script. <strong>Please use DSC::R_libs instead if this is not the desired behavior</strong>.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-DSC-on-HPC-cluster-or-other-remote-computaters">Run DSC on HPC cluster or other remote computaters<a class="anchor-link" href="#Run-DSC-on-HPC-cluster-or-other-remote-computaters">&#182;</a></h2><p>See <a href="Remote_Computations.html">this documentation</a> for a discussion.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Ready-to-indulge?">Ready to indulge?<a class="anchor-link" href="#Ready-to-indulge?">&#182;</a></h2><p>At this point we have covered the basics to compose a DSC benchmark. To see how it works in practice with a simple example, please follow through this <a href="../tutorials/5_Minutes.html">5 Minutes DSC tutorial</a>.</p>

</div>
</div>
</div>
<hr>
Copyright (c) 2016-2018 <a href="http://home.uchicago.edu/gaow">Gao Wang</a>, <a href="http://stephenslab.uchicago.edu">Matthew Stephens</a>, <a href="https://pcarbo.github.io">Peter Carbonetto</a> and contributors.<br>&nbsp;&nbsp;&nbsp; Except where otherwise noted, this website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.

</div>
</div>
</body>
</html>
