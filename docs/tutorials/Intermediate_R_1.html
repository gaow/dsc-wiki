<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107286198-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());
  gtag('config', 'UA-107286198-1');
</script>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="ipynb_website:version" content="0.9.3" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="../css/jt.css">

<link rel="stylesheet" type="text/css" href="../css/toc2.css">

<link href="../site_libs/jqueryui-1.11.4/jquery-ui.css">
<link rel="stylesheet" href="../site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<link rel="stylesheet" href="../site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<link rel="stylesheet"
      href="../site_libs/highlightjs-1.1/textmate.css"
      type="text/css" />

<script src="../site_libs/highlightjs-1.1/highlight.js"></script>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>

<script src="../js/doc_toc.js"></script>
<script src="../js/docs.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": {
            preferredFont: "TeX",
            availableFonts: ["TeX"],
            styles: {
                scale: 110,
                ".MathJax_Display": {
                    "font-size": "110%",
                }
            }
        }
    });
</script>
<script>
function filterDataFrame(id) {
    var input = document.getElementById("search_" + id);
    var filter = input.value.toUpperCase();
    var table = document.getElementById("dataframe_" + id);
    var tr = table.getElementsByTagName("tr");
    // Loop through all table rows, and hide those who don't match the search query
    for (var i = 1; i < tr.length; i++) {
        for (var j = 0; j < tr[i].cells.length; ++j) {
            var matched = false;
            if (tr[i].cells[j].innerHTML.toUpperCase().indexOf(filter) != -1) {
                tr[i].style.display = "";
                matched = true
                break;
            }
            if (!matched)
                tr[i].style.display = "none";
        } 
    }
}
function sortDataFrame(id, n, dtype) {
    var table = document.getElementById("dataframe_" + id);
    var tb = table.tBodies[0]; // use `<tbody>` to ignore `<thead>` and `<tfoot>` rows
    var tr = Array.prototype.slice.call(tb.rows, 0); // put rows into array
    if (dtype === 'numeric') {
        var fn = function(a, b) { 
            return parseFloat(a.cells[n].textContent) <= parseFloat(b.cells[n].textContent) ? -1 : 1;
        }
    } else {
        var fn = function(a, b) {
            var c = a.cells[n].textContent.trim().localeCompare(b.cells[n].textContent.trim()); 
            return c > 0 ? 1 : (c < 0 ? -1 : 0) }
    }
    var isSorted = function(array, fn) {
        if (array.length < 2)
            return 1;
        var direction = fn(array[0], array[1]); 
        for (var i = 1; i < array.length - 1; ++i) {
            var d = fn(array[i], array[i+1]);
            if (d == 0)
                continue;
            else if (direction == 0)
                direction = d;
            else if (direction != d)
                return 0;
            }
        return direction;
    }
    var sorted = isSorted(tr, fn);
    if (sorted == 1 || sorted == -1) {
        // if sorted already, reverse it
        for(var i = tr.length - 1; i >= 0; --i)
            tb.appendChild(tr[i]); // append each row in order
    } else {
        tr = tr.sort(fn);
        for(var i = 0; i < tr.length; ++i)
            tb.appendChild(tr[i]); // append each row in order
    }
}
</script>

<script>
$( document ).ready(function(){
            var cfg={'threshold':3,     // depth of toc (number of levels)
             'number_sections': false,
             'toc_cell': false,          // useless here
             'toc_window_display': true, // display the toc window
             "toc_section_display": "block", // display toc contents in the window
             'sideBar':true,       // sidebar or floating window
             'navigate_menu':false       // navigation menu (only in liveNotebook -- do not change)
            }
            var st={};                  // some variables used in the script
            st.rendering_toc_cell = false;
            st.config_loaded = false;
            st.extension_initialized=false;
            st.nbcontainer_marginleft = $('#notebook-container').css('margin-left')
            st.nbcontainer_marginright = $('#notebook-container').css('margin-right')
            st.nbcontainer_width = $('#notebook-container').css('width')
            st.oldTocHeight = undefined
            st.cell_toc = undefined;
            st.toc_index=0;
            // fire the main function with these parameters
            table_of_contents(cfg, st);
            var file=tutorialsDict[$("h1:first").attr("id")];
            $("#toc-level0 a").css("color","#126dce");
            $('a[href="#'+$("h1:first").attr("id")+'"]').hide()
            var docs=tutorialsArray;
            var pos=tutorialsArray.indexOf(file);
            for (var a=pos;a>=0;a--){
                  var name=docs[a]
                  $('<li><a href="'+name+'.html"><font color="#073642"><b>'+name.replace(/_/g," ")+'</b></font></a></li>').insertBefore("#toc-level0 li:eq(0)");
            }
            $('a[href="'+file+'.html'+'"]').css("color","#126dce");
            for (var a=pos+1;a<docs.length;a++){
                  var name=docs[a]
                  $(".toc #toc-level0").append('<li><a href="'+name+'.html"><font color="#073642"><b>'+name.replace(/_/g," ")+'</b></font></a></li>');
            }
            $("#toc-header").hide();
    });
</script>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');
  // mark it active
  menuAnchor.parent().addClass('active');
  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>
<div class="container-fluid main-container">
<!-- tabsets -->
<script src="../site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>



<title>Dynamic Statistical Comparisons</title>

<style type = "text/css">
body {
  font-family: "Droid Sans";
  padding-top: 66px;
  padding-bottom: 40px;
}
</style>
</head>

<body>
<div tabindex="-1" id="notebook" class="border-box-sizing">
<div class="container" id="notebook-container">

<!-- code folding -->

<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Dynamic Statistical Comparisons</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
<li>
  <a href="../index.html">Overview</a>
</li>
        
<li>
  <a href="../quick_start.html">Quick Start</a>
</li>
        
<li>
  <a href="../manual.html">Manual</a>
</li>
        
<li>
  <a href="../tutorials.html">Tutorials</a>
</li>
        
<li>
  <a href="../examples.html">Examples</a>
</li>
        
      </ul>
        
<ul class="nav navbar-nav navbar-right">
<li>
   <a href="https://github.com/stephenslab/dsc2"> <span class="fa fa-github"></span> </a>
</li>
</ul>
        
      </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="An-R-example:-ashr-benchmark">An R example: ashr benchmark<a class="anchor-link" href="#An-R-example:-ashr-benchmark">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a more advanced application of DSC with R scripts. We demonstrate in this tutorial features of DSC2 including:</p>
<ul>
<li>Inline code as parameters</li>
<li><code>@ALIAS</code> decorator</li>
<li>R library installation and version check</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DSC-Problem">DSC Problem<a class="anchor-link" href="#DSC-Problem">&#182;</a></h2><p>The DSC problem is based on the ASH example of DSCR (<a href="https://github.com/stephens999/dscr/blob/master/vignettes/dsc_shrink.rmd">R Markdown version</a> and <a href="dscr_dsc_shrink.html">HTML version</a>). Material to run this tutorial can be found in <a href="https://github.com/stephenslab/dsc2/tree/master/vignettes/ash">DSC2 vignettes repo</a>. Description below is copied from the DSCR vignette:</p>
<blockquote><p>To illustrate we consider the problem of shrinkage, which is tackled by the <code>ashr</code> package at <a href="http://www.github.com/stephens999/ashr">http://www.github.com/stephens999/ashr</a>. The input to this DSC is a set of estimates $\hat\beta$,  with associated standard errors $s$. These values are estimates of actual (true) values for $\beta$, so the meta-data in this case are the true values of beta. Methods must take $\hat\beta$ and $s$ as input, and provide as output "shrunk" estimates for $\beta$ (so output is a list with one element, called <code>beta_est</code>, which is a vector of estimates for beta). The score function then scores methods on their RMSE comparing <code>beta_est</code> with beta.</p>
<p>First define a datamaker which simulates true values of $\beta$ from a user-specified normal mixture, where one of the components is a point mass at 0 of mass $\pi_0$, which is a user-specified parameter. It then simulates $\hat\beta \sim N(\beta_j,s_j)$ (where $s_j$ is again user-specified). It returns the true $\beta$ values and true $\pi_0$ value as meta-data, and the estimates $\hat\beta$ and $s$ as input-data.</p>
<p>Now define a <a href="https://github.com/stephenslab/dsc2/blob/master/vignettes/ash/bin/runash.R">method wrapper</a> for the <code>ash</code> function from the <code>ashr</code> package. Notice that this wrapper does not return output in the required format - it simply returns the entire ash output.</p>
<p>Finally add a generic (can be used to deal with both $\pi$ and $\beta$) <a href="https://github.com/stephenslab/dsc2/blob/master/vignettes/ash/bin/score.R">score function</a> to evaluate estimates by <code>ash</code>.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DSC-Specification">DSC Specification<a class="anchor-link" href="#DSC-Specification">&#182;</a></h2><p>The problem is fully specified in DSC2 language below, following the structure of the original DSCR implementation:</p>

<pre><code># module alias and executables
simulate: datamaker.R
    # module input and variables
    seed: R(1:5)
    g: raw(ashr::normalmix(c(2/3,1/3),c(0,0),c(1,2))),
       raw(ashr::normalmix(rep(1/7,7),c(-1.5,-1,-0.5,0,0.5,1,1.5),rep(0.5,7))),
       raw(ashr::normalmix(c(1/4,1/4,1/3,1/6),c(-2,-1,0,1),c(2,1.5,1,1)))
    min_pi0: 0
    max_pi0: 1
    nsamp: 1000
    betahatsd: 1
    # module decoration
    @ALIAS: args = list()
    @CONF: queue = midway
    # module output
    $data: data
    $true_beta: raw(data$meta$beta)
    $true_pi0: raw(data$meta$pi0)

shrink: runash.R
    # module input and variables
    input: $data
    mixcompdist: normal, halfuniform
    # module output
    $ash_data: ash_data
    $beta_est: raw(ashr::get_pm(ash_data))
    $pi0_est: raw(ashr::get_pi0(ash_data))

score_beta: score.R
    # module input and variables
    est: $true_beta
    truth: $beta_est
    # module output aka pipeline variable
    $mse_beta: result

score_pi0: score.R
    # module input and variables
    est: $pi0_est
    truth: $true_pi0
    # module output
    $mse_pi: result

DSC:
    # module ensembles
    define:
      score: score_beta, score_pi0
    # pipelines
    run: simulate * shrink * score
    # runtime environments
    R_libs: ashr@stephens999/ashr (2.0.0+)
    exec_path: bin
    output: dsc_result
    # pipeline variables, will overwrite any module variables of the same name
    # it is also place to config the global random number generator</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is suggested that you check out the corresponding R codes for modules <a href="https://github.com/stephenslab/dsc2/blob/master/vignettes/ash/bin/datamaker.R"><code>simulate</code></a>, <a href="https://github.com/stephenslab/dsc2/blob/master/vignettes/ash/bin/runash.R"><code>shrink</code></a> and the <a href="https://github.com/stephenslab/dsc2/blob/master/vignettes/ash/bin/score.R">score function</a> to figure out how DSC2 communicates with your R scripts.</p>
<p>Here we will walk through all modules to highlight important syntactical elements.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Module-simulate">Module <code>simulate</code><a class="anchor-link" href="#Module-simulate">&#182;</a></h3><h4 id="Inline-code-as-parameters-and-output-values">Inline code as parameters and output values<a class="anchor-link" href="#Inline-code-as-parameters-and-output-values">&#182;</a></h4><p>The parameter <code>g</code> has three candidate values, all of which are R codes inside <code>raw()</code> function. Contents inside <code>raw()</code> will be interpreted as functional code pieces rather than strings. In other words, DSC2 will interpret it as <code>g &lt;- ashr::normalmix(c(2/3,1/3),c(0,0),c(1,2))</code> so that <code>g</code> will be assigned <strong>at runtime</strong> output of R codes in <code>raw()</code> for use with <code>datamaker.R</code>. Without <code>raw</code>, this line will be interpreted as a string assigned to <code>g</code> which apparently is problematic. Similarly, <code>$true_beta: raw(data$meta$beta)</code> extracts data at runtime and assign it to output variable.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Decorator-@ALIAS-for-R-list">Decorator <code>@ALIAS</code> for R list<a class="anchor-link" href="#Decorator-@ALIAS-for-R-list">&#182;</a></h4><p>Inside <code>datamaker.R</code> the input for the core function is a single parameter of an R <a href="http://www.r-tutor.com/r-introduction/list">list</a> containing all parameters specified in this module. The decorator <code>@ALIAS</code> uses a special DSC2 operation <code>List()</code> to consolidate these parameters into an R list <code>args</code> which corresponds to the input parameter in <code>datamaker.R</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Module-shrink">Module <code>shrink</code><a class="anchor-link" href="#Module-shrink">&#182;</a></h3><p>Here notice the output variable are also provided at runtime via "raw" pieces of R codes, which, in this case, is <code>get_pi0</code> function from <code>ashr</code> package.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Module-beta_score-&amp;-pi0_score">Module <code>beta_score</code> &amp; <code>pi0_score</code><a class="anchor-link" href="#Module-beta_score-&amp;-pi0_score">&#182;</a></h3><p>These modules uses the same computational routine <code>score.R</code> but on different input data. Due to differences in variable names it is best to configure them in separate blocks. However an alternative style that configures them in the same block is:</p>

<pre><code>score_beta, score_pi0: score.R
    @score_beta:
        est: $true_beta
        truth: $beta_est
        $mse_beta: result
    @score_pi0:
        est: $pi0_est
        truth: $true_pi0
        $mse_pi: result</code></pre>
<p>Here <code>@*</code> are module specific variable decorations that configures input and output such that different modules can be allowed in the same block.</p>
<p>Notice that different from the <a href="https://github.com/stephens999/dscr/blob/master/vignettes/dsc_shrink.rmd">DSCR ASH example</a> the output score is an "atomic" value (a float of RMSE). If the outcome object <code>result</code> is not such a simple object, for example it returns an R list, then you may want to use the <code>raw</code> operator to only keep the information you need so that they'll be readily extractable in the benchmark query process. To do so, e.g., <code>$mse_pi: raw(score_output$mse)</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="DSC-section"><code>DSC</code> section<a class="anchor-link" href="#DSC-section">&#182;</a></h3><p>As has been discussed in previous tutorials, <code>DSC::run</code> defines module ensembles and executes essentially two pipelines (one ending with <code>score_beta</code> another with <code>score_pi0</code>). The <code>R_libs</code> entry specifies the R package required by the DSC. It is formatted as a github package (<code>repo/pkg</code>) and the minimal version requirement is <code>2.0.0</code>. DSC will check first if the package is available, and install it if necessary. It will then check its version and quit on error if it does not satisfy the requirement. <strong>DSC does not attempt to upgrade/downgrade a package in cases of version mismatch.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Execution-logic">Execution logic<a class="anchor-link" href="#Execution-logic">&#182;</a></h2><p>This diagram (generated by <code>dot</code> command using the execution graph from this DSC) shows the logic of this benchmark:</p>
<p><img src="../img/ash.png" alt="ash.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-DSC">Run DSC<a class="anchor-link" href="#Run-DSC">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="err">!</span> <span class="n">dsc</span> <span class="n">settings</span><span class="o">.</span><span class="n">dsc</span> <span class="o">-</span><span class="n">c</span> <span class="mi">30</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>INFO: DSC script exported to <span class="ansi-green-fg">dsc_result.html</span>
INFO: Constructing DSC from <span class="ansi-green-fg">settings.dsc</span> ...
INFO: Building execution graph ...
INFO: DSC in progress ...
DSC: 100%|████████████████████████████████████████| 5/5 [00:30&lt;00:00,  4.26s/it]
INFO: Building DSC database ...
INFO: DSC complete!
INFO: Elapsed time <span class="ansi-green-fg">38.572</span> seconds.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Result-extraction">Result extraction<a class="anchor-link" href="#Result-extraction">&#182;</a></h2><p><strong><em>FIXME: Update with dscrutils extraction interface</em></strong></p>
<h3 id="Obtain-final-score-for-methods-comparison">Obtain final score for methods comparison<a class="anchor-link" href="#Obtain-final-score-for-methods-comparison">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can examine the result in <code>R</code>, similar to what we have done in the <a href="Explore_Output.html">Quick Start example</a>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="o">%</span><span class="n">use</span> <span class="n">ir</span>
<span class="n">options</span><span class="p">(</span><span class="n">warn</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">readRDS</span><span class="p">(</span><span class="s1">&#39;ashr_pi0_1.rds&#39;</span><span class="p">)</span>
<span class="n">case1</span> <span class="o">=</span> <span class="n">unlist</span><span class="p">(</span><span class="n">dat</span><span class="err">$</span><span class="n">case1_pi0_score_result</span><span class="p">)</span>
<span class="n">case2</span> <span class="o">=</span> <span class="n">unlist</span><span class="p">(</span><span class="n">dat</span><span class="err">$</span><span class="n">case2_pi0_score_result</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">suppressMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">))</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">plot_ly</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">case1</span><span class="p">,</span> <span class="kp">name</span> <span class="o">=</span> <span class="s1">&#39;case 1&#39;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">add_trace</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">case2</span><span class="p">,</span> <span class="kp">name</span> <span class="o">=</span> <span class="s1">&#39;case 2&#39;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span>  <span class="o">%&gt;%</span> 
  <span class="n">layout</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;MSE for pi_0 estimate&quot;</span><span class="p">)</span>
<span class="kn">htmlwidgets:</span><span class="p">:</span><span class="n">saveWidget</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s2">&quot;pi0_score.html&quot;</span><span class="p">)</span>
<span class="c1"># IRdisplay::display_html(paste(readLines(&quot;pi0_score.html&quot;), collapse=&quot;\n&quot;))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can view the output <a href="pi0_score.html">here</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Obtain-intermediate-output">Obtain intermediate output<a class="anchor-link" href="#Obtain-intermediate-output">&#182;</a></h3><p>You can also extract quantities of interest in any steps in a DSC sequence. For example we want to compare MSE for posterior mean estimate, and at the same time we want to explore the distribution of posterior mean. We first extract both quantities:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="err">!</span> <span class="n">dsc</span> <span class="o">-</span><span class="n">e</span> <span class="n">beta_score</span><span class="p">:</span><span class="n">result</span> <span class="n">shrink</span><span class="p">:</span><span class="n">beta_est</span> <span class="o">--</span><span class="n">target</span> <span class="n">beta_score</span> <span class="o">-</span><span class="n">o</span> <span class="n">ashr_beta_1</span><span class="o">.</span><span class="n">rds</span> \
    <span class="o">--</span><span class="kp">tags</span> <span class="s2">&quot;case1 = An &amp;&amp; ash_n&quot;</span> <span class="s2">&quot;case2 = An &amp;&amp; ash_hu&quot;</span> <span class="o">-</span><span class="n">b</span> <span class="n">dsc_result</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Extracting: 100%|██████████| 5/5 [00:01&lt;00:00,  4.86it/s]
INFO: Data extracted to <span class="ansi-green-fg">ashr_beta_1.rds</span> for DSC result <span class="ansi-green-fg">beta_score</span> via annotations: 
	<span class="ansi-green-fg">case1 = An &amp;&amp; ash_n
	case2 = An &amp;&amp; ash_hu</span>
INFO: Elapsed time <span class="ansi-green-fg">2.013</span> seconds.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we plot them both:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="o">%</span><span class="n">use</span> <span class="n">ir</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">readRDS</span><span class="p">(</span><span class="s1">&#39;ashr_beta_1.rds&#39;</span><span class="p">)</span>
<span class="n">case1</span> <span class="o">=</span> <span class="n">unlist</span><span class="p">(</span><span class="n">dat</span><span class="err">$</span><span class="n">case1_beta_score_result</span><span class="p">)</span>
<span class="n">case2</span> <span class="o">=</span> <span class="n">unlist</span><span class="p">(</span><span class="n">dat</span><span class="err">$</span><span class="n">case2_beta_score_result</span><span class="p">)</span>
<span class="n">case1_beta</span> <span class="o">=</span> <span class="n">rowMeans</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">dat</span><span class="err">$</span><span class="n">case1_shrink_beta_est</span><span class="p">))</span>
<span class="n">case2_beta</span> <span class="o">=</span> <span class="n">rowMeans</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">dat</span><span class="err">$</span><span class="n">case2_shrink_beta_est</span><span class="p">))</span>
<span class="c1">#</span>
<span class="n">suppressMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">))</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">plot_ly</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">case1</span><span class="p">,</span> <span class="kp">name</span> <span class="o">=</span> <span class="s1">&#39;case 1&#39;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">add_trace</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">case2</span><span class="p">,</span> <span class="kp">name</span> <span class="o">=</span> <span class="s1">&#39;case 2&#39;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span>  <span class="o">%&gt;%</span> 
  <span class="n">layout</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;MSE for beta estimate&quot;</span><span class="p">)</span>
<span class="kn">htmlwidgets:</span><span class="p">:</span><span class="n">saveWidget</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s2">&quot;beta_score.html&quot;</span><span class="p">)</span>
<span class="c1">#IRdisplay::display_html(paste(readLines(&quot;beta_score.html&quot;), collapse=&quot;\n&quot;))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can view the output <a href="beta_score.html">here</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">plot_ly</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">case1_beta</span><span class="p">,</span> <span class="kp">name</span> <span class="o">=</span> <span class="s1">&#39;case 1&#39;</span><span class="p">,</span> <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;histogram&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">add_trace</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">case2_beta</span><span class="p">,</span> <span class="kp">name</span> <span class="o">=</span> <span class="s1">&#39;case 2&#39;</span><span class="p">,</span> <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;histogram&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">layout</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Posterior mean distribution&quot;</span><span class="p">)</span>
<span class="kn">htmlwidgets:</span><span class="p">:</span><span class="n">saveWidget</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s2">&quot;beta.html&quot;</span><span class="p">)</span>
<span class="c1">#IRdisplay::display_html(paste(readLines(&quot;beta.html&quot;), collapse=&quot;\n&quot;))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can view the output <a href="beta.html">here</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Benchmarking-runtime">Benchmarking runtime<a class="anchor-link" href="#Benchmarking-runtime">&#182;</a></h3><p>You can also benchmark the time it takes to run a computational step. For example:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">case1</span> <span class="o">=</span> <span class="n">unlist</span><span class="p">(</span><span class="n">dat</span><span class="err">$</span><span class="n">DSC_TIMER</span><span class="err">$</span><span class="n">case1_shrink_beta_est</span><span class="p">)</span>
<span class="n">case2</span> <span class="o">=</span> <span class="n">unlist</span><span class="p">(</span><span class="n">dat</span><span class="err">$</span><span class="n">DSC_TIMER</span><span class="err">$</span><span class="n">case2_shrink_beta_est</span><span class="p">)</span>
<span class="c1">#</span>
<span class="n">suppressMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">))</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">plot_ly</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">case1</span><span class="p">,</span> <span class="kp">name</span> <span class="o">=</span> <span class="s1">&#39;case 1&#39;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">add_trace</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">case2</span><span class="p">,</span> <span class="kp">name</span> <span class="o">=</span> <span class="s1">&#39;case 2&#39;</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;box&quot;</span><span class="p">)</span>  <span class="o">%&gt;%</span> 
  <span class="n">layout</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Time elapsed for posterior mean estimation&quot;</span><span class="p">)</span>
<span class="kn">htmlwidgets:</span><span class="p">:</span><span class="n">saveWidget</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s2">&quot;beta_time.html&quot;</span><span class="p">)</span>
<span class="c1">#IRdisplay::display_html(paste(readLines(&quot;beta_time.html&quot;), collapse=&quot;\n&quot;))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can view the output <a href="beta_time.html">here</a>.</p>

</div>
</div>
</div>
<hr>
&copy 2016-2018 <a href="http://home.uchicago.edu/gaow">Gao Wang</a> at Stephens Lab, the University of Chicago.<br>&nbsp;&nbsp;&nbsp;This wiki is available under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution license</a> (read <a href="https://creativecommons.org/licenses/by/4.0/legalcode">full legal text</a>).

</div>
</div>
</body>
</html>
