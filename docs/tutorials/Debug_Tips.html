
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="ipynb_website:version" content="0.9.4" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="../css/jt.css">

<link rel="stylesheet" type="text/css" href="../css/toc2.css">

<link href="../site_libs/jqueryui-1.11.4/jquery-ui.css">
<link rel="stylesheet" href="../site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<link rel="stylesheet" href="../site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<link rel="stylesheet"
      href="../site_libs/highlightjs-1.1/textmate.css"
      type="text/css" />

<script src="../site_libs/highlightjs-1.1/highlight.js"></script>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>

<script src="../js/doc_toc.js"></script>
<script src="../js/docs.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": {
            preferredFont: "TeX",
            availableFonts: ["TeX"],
            styles: {
                scale: 110,
                ".MathJax_Display": {
                    "font-size": "110%",
                }
            }
        }
    });
</script>
<script>
function filterDataFrame(id) {
    var input = document.getElementById("search_" + id);
    var filter = input.value.toUpperCase();
    var table = document.getElementById("dataframe_" + id);
    var tr = table.getElementsByTagName("tr");
    // Loop through all table rows, and hide those who don't match the search query
    for (var i = 1; i < tr.length; i++) {
        for (var j = 0; j < tr[i].cells.length; ++j) {
            var matched = false;
            if (tr[i].cells[j].innerHTML.toUpperCase().indexOf(filter) != -1) {
                tr[i].style.display = "";
                matched = true
                break;
            }
            if (!matched)
                tr[i].style.display = "none";
        }
    }
}
function sortDataFrame(id, n, dtype) {
    var table = document.getElementById("dataframe_" + id);
    var tb = table.tBodies[0]; // use `<tbody>` to ignore `<thead>` and `<tfoot>` rows
    var tr = Array.prototype.slice.call(tb.rows, 0); // put rows into array
    if (dtype === 'numeric') {
        var fn = function(a, b) { 
            return parseFloat(a.cells[n].textContent) <= parseFloat(b.cells[n].textContent) ? -1 : 1;
        }
    } else {
        var fn = function(a, b) {
            var c = a.cells[n].textContent.trim().localeCompare(b.cells[n].textContent.trim()); 
            return c > 0 ? 1 : (c < 0 ? -1 : 0) }
    }
    var isSorted = function(array, fn) {
        if (array.length < 2)
            return 1;
        var direction = fn(array[0], array[1]); 
        for (var i = 1; i < array.length - 1; ++i) {
            var d = fn(array[i], array[i+1]);
            if (d == 0)
                continue;
            else if (direction == 0)
                direction = d;
            else if (direction != d)
                return 0;
            }
        return direction;
    }
    var sorted = isSorted(tr, fn);
    if (sorted == 1 || sorted == -1) {
        // if sorted already, reverse it
        for(var i = tr.length - 1; i >= 0; --i)
            tb.appendChild(tr[i]); // append each row in order
    } else {
        tr = tr.sort(fn);
        for(var i = 0; i < tr.length; ++i)
            tb.appendChild(tr[i]); // append each row in order
    }
}
</script>

<script>
$( document ).ready(function(){
            var cfg={'threshold':3,     // depth of toc (number of levels)
             'number_sections': false,
             'toc_cell': false,          // useless here
             'toc_window_display': true, // display the toc window
             "toc_section_display": "block", // display toc contents in the window
             'sideBar':true,       // sidebar or floating window
             'navigate_menu':false       // navigation menu (only in liveNotebook -- do not change)
            }
            var st={};                  // some variables used in the script
            st.rendering_toc_cell = false;
            st.config_loaded = false;
            st.extension_initialized=false;
            st.nbcontainer_marginleft = $('#notebook-container').css('margin-left')
            st.nbcontainer_marginright = $('#notebook-container').css('margin-right')
            st.nbcontainer_width = $('#notebook-container').css('width')
            st.oldTocHeight = undefined
            st.cell_toc = undefined;
            st.toc_index=0;
            // fire the main function with these parameters
            table_of_contents(cfg, st);
            var file=tutorialsDict[$("h1:first").attr("id")];
            $("#toc-level0 a").css("color","#126dce");
            $('a[href="#'+$("h1:first").attr("id")+'"]').hide()
            var docs=tutorialsArray;
            var docs_map=tutorialsArrayMap;
            var pos=tutorialsArray.indexOf(file);
            for (var a=pos;a>=0;a--){
                  $('<li><a href="'+docs[a]+'.html"><font color="#073642"><b>'+docs_map[docs[a]].replace(/_/g," ")+'</b></font></a></li>').insertBefore("#toc-level0 li:eq(0)");
            }
            $('a[href="'+file+'.html'+'"]').css("color","#126dce");
            for (var a=pos+1;a<docs.length;a++){
                  $(".toc #toc-level0").append('<li><a href="'+docs[a]+'.html"><font color="#073642"><b>'+docs_map[docs[a]].replace(/_/g," ")+'</b></font></a></li>');
            }
            // $("#toc-header").hide(); // comment out because it prevents search bar from displaying
    });
</script>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');
  // mark it active
  menuAnchor.parent().addClass('active');
  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>
<div class="container-fluid main-container">
<!-- tabsets -->
<script src="../site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>



<title>Dynamic Statistical Comparisons</title>

<style type = "text/css">
body {
  font-family: "Droid Sans";
  padding-top: 66px;
  padding-bottom: 40px;
}
</style>
</head>

<body>
<div tabindex="-1" id="notebook" class="border-box-sizing">
<div class="container" id="notebook-container">

<!-- code folding -->

<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Dynamic Statistical Comparisons</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
<li>
  <a href="../index.html">Home</a>
</li>
        
<li>
  <a href="../tutorials.html">Tutorials</a>
</li>
        
<li>
  <a href="../installation.html">Installation</a>
</li>
        
<li>
  <a href="../examples.html">Examples</a>
</li>
        
<li>
  <a href="../manual.html">Manual</a>
</li>
        
      </ul>
        
<ul class="nav navbar-nav navbar-right">
<li>
   <a href="https://github.com/stephenslab/dsc2"> <span class="fa fa-github"></span> </a>
</li>
</ul>
        
      </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Debugging-in-DSC">Debugging in DSC<a class="anchor-link" href="#Debugging-in-DSC">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Module-executable-and-generated-script">Module executable and generated script<a class="anchor-link" href="#Module-executable-and-generated-script">&#182;</a></h2><p>As seen from previous tutorials, the <a href="dsc_result.html">module executables in DSC</a> are in fact incomplete due to lack of input data and parameter specifications to run. Under the hood, DSC generates R, Python or Shell scripts based on module executable scripts, adding to it specification of module parameters and pipeline variables, then executes the complete script. This generated script is subject to two types of errors:</p>
<ol>
<li>Inconsistency between DSC interface and module executables</li>
<li>Error from module executables as provided</li>
</ol>
<p>In the presence of errors DSC will fail. However the automatically generated script will be saved to disk and will be pointed to you as part of the error prompt on the command console so that you can reproduce and fix the bugs.</p>
<p>Here we look at <a href="https://github.com/stephenslab/dsc/tree/32311ab75848ae053fe7dbf614d06337a5f8238e/vignettes/one_sample_location">this toy example</a>. We undermine the setup to demonstrate the 2 types of errors we have discussed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Buggy-DSC-interface">Buggy DSC interface<a class="anchor-link" href="#Buggy-DSC-interface">&#182;</a></h2><p>To demonstrate inconsistency between interface and module we change the first block of DSC script from:</p>

<pre><code>normal, t: rnorm.R, rt.R
    seed: R(1:5)</code></pre>
<p>to:</p>

<pre><code>normal, t: rnorm.R, rt.R
    weed: R(1:5)</code></pre>
<p>creating a parameter <code>weed</code>, a typo of <code>seed</code>, that does not exist in <code>rnorm.R</code> and <code>rt.R</code>. Consequently the required <code>seed</code> variable for these routines will not be provided by DSC interface. We save this configuration file as <code>settings_error_v1.dsc</code> and run it:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="err">!</span> <span class="n">dsc</span> <span class="n">settings_error_v1</span><span class="o">.</span><span class="n">dsc</span> <span class="o">--</span><span class="kp">skip</span> <span class="n">none</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-green-intense-fg ansi-bold">INFO: Checking R library dscrutils@stephenslab/dsc/dscrutils ...</span>
INFO: DSC script exported to <span class="ansi-green-fg">dsc_result.html</span>
INFO: Constructing DSC from <span class="ansi-green-fg">settings_error_v1.dsc</span> ...
INFO: Building execution graph &amp; running DSC ...
DSC:  18%|███████                                | 2/11 [00:01&lt;00:05,  1.60it/s]
<span class="ansi-red-intense-fg">ERROR</span>: <span class="ansi-red-intense-fg">[3808530b-4117-459c-990c-ab31d5074b42]: [normal_0]: 
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
script_6123501901101114663 in &lt;module&gt;
      ## END code by DSC
      
----&gt; &#34;&#34;&#34;, workdir = &#39;./&#39;, stderr = None, stdout = None)

RuntimeError: Failed to execute commmand </span><span class="ansi-green-fg">Rscript --default-packages=datasets,methods,utils,stats,grDevices,graphics  /home/gaow/GIT/dsc/vignettes/one_sample_location/.sos/normal_0_0_652e6bc3.R</span><span class="ansi-red-intense-fg"> (ret=1, workdir=/home/gaow/GIT/dsc2/vignettes/one_sample_location)
[49bb3658-fb20-4736-b8d4-1d9c2ee0c6f4]: [t_0]: 
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
script_-5770973451880312504 in &lt;module&gt;
      ## END code by DSC
      
----&gt; &#34;&#34;&#34;, workdir = &#39;./&#39;, stderr = None, stdout = None)

RuntimeError: Failed to execute commmand </span><span class="ansi-green-fg">Rscript --default-packages=datasets,methods,utils,stats,grDevices,graphics  /home/gaow/GIT/dsc/vignettes/one_sample_location/.sos/t_0_0_b8a69d4f.R</span><span class="ansi-red-intense-fg"> (ret=1, workdir=/home/gaow/GIT/dsc2/vignettes/one_sample_location)
[DSC]: 9 pending steps: DSC_0, a_mse, b_mse, c_mse, d_mse, a_mean, b_median, c_mean, d_median</span>
<span class="ansi-magenta-intense-fg">WARNING</span>: <span class="ansi-magenta-intense-fg">If needed, you can open </span><span class="ansi-green-fg">dsc_result.scripts.html</span><span class="ansi-magenta-intense-fg"> and use </span><span class="ansi-green-fg">ctrl-F</span><span class="ansi-magenta-intense-fg"> to search by file names to trace back problematic chunks of code.</span>
INFO: Elapsed time <span class="ansi-green-fg">5.065</span> seconds.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The error message is a bit wordy but the part most relevant to debugging are highlighted in green color on your terminal. In this case multiple generated scripts have failed, but the cause is likely the same. You can try to resolve the problem starting from the last error message and see if the fix will help with other errors.</p>
<p>You can also see that a file called <code>dsc_result.scripts.html</code> is generated. It bundles generated scripts from all module instances involved in the benchmark up to the point the errors occur.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Debug-with-the-problematic-script">Debug with the problematic script<a class="anchor-link" href="#Debug-with-the-problematic-script">&#182;</a></h3><p>As prompted in the error message, let's try to execute <code>.sos/t_0_0_b8a69d4f.R</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="err">!</span> <span class="n">Rscript</span> <span class="o">.</span><span class="n">sos</span><span class="o">/</span><span class="n">t_0_0_b8a69d4f</span><span class="o">.</span><span class="n">R</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Error in set.seed(seed) : object &#39;seed&#39; not found
Execution halted
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Okey so what's going on? Let's take a look at this script:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="o">%</span><span class="n">preview</span> <span class="o">.</span><span class="n">sos</span><span class="o">/</span><span class="n">t_0_0_b8a69d4f</span><span class="o">.</span><span class="n">R</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div class="sos_hint">> .sos/t_0_0_b8a69d4f.R (337 B):</div>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>## r script UUID: c218f56b48d262e5
## BEGIN code by DSC
n &lt;- 1000
true_mean &lt;- 0
weed &lt;- 1
DSC_4AAF65D6_tic_pt &lt;- proc.time()
## END code by DSC
set.seed(seed)
x=true_mean+rt(n,df=2)
## BEGIN code by DSC
saveRDS(list(x=x, true_mean=true_mean, DSC_TIMER = proc.time() - DSC_4AAF65D6_tic_pt), &#39;dsc_result/t_1.rds&#39;)
## END code by DSC

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It looks like <code>set.seed()</code> looks for variable <code>seed</code>, which was not provided by DSC. We know from the <a href="https://github.com/stephenslab/dsc/blob/master/vignettes/one_sample_location/settings_error_v1.dsc">DSC script</a> that we had set <code>weed</code> not <code>seed</code>. So obviously there is a glitch on the interface which can be fixed by changing <code>weed</code> to <code>seed</code> in the DSC script.</p>
<p>In practice when you identify problems that does not have an obvious fix such as this one, you should load the problematic script <code>.sos/t_0_0_b8a69d4f.R</code> to some interactive session, try to debug and fix the script from there (do not worry about changing this script), test until it works. Then you should have learned where the problem is, and you can apply what you've learned to patching DSC script or the original module code. <em>Fixing these generated scripts is not enough as they will be overwritten next time DSC runs</em>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Buggy-module-script">Buggy module script<a class="anchor-link" href="#Buggy-module-script">&#182;</a></h2><p>Now let's undermine the module code instead. We change <code>R/methods/mean.R</code> from:</p>
<div class="highlight"><pre><span></span>mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">)</span>
</pre></div>
<p>to</p>
<div class="highlight"><pre><span></span>mean <span class="o">=</span> <span class="s">&#39;meow&#39;</span>
</pre></div>
<p>As you can probably tell, this will not result an error for this module, but may impact downstream ones. So let's find it out!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="err">!</span> <span class="n">dsc</span> <span class="n">settings_error_v2</span><span class="o">.</span><span class="n">dsc</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>INFO: DSC script exported to <span class="ansi-green-fg">dsc_result.html</span>
INFO: Constructing DSC from <span class="ansi-green-fg">settings_error_v2.dsc</span> ...
INFO: Building execution graph &amp; running DSC ...
DSC:  91%|██████████████████████████████████▌   | 10/11 [00:08&lt;00:00,  1.22it/s]
<span class="ansi-red-intense-fg">ERROR</span>: <span class="ansi-red-intense-fg">[01278859-93de-4e0c-8126-f4af09cf28eb]: [mse_0]: 
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
script_4384414397566502935 in &lt;module&gt;
      ## END code by DSC
      
----&gt; &#34;&#34;&#34;, workdir = &#39;./&#39;, stderr = None, stdout = None)

RuntimeError: Failed to execute commmand </span><span class="ansi-green-fg">Rscript --default-packages=datasets,methods,utils,stats,grDevices,graphics  /home/gaow/GIT/dsc/vignettes/one_sample_location/.sos/mse_0_0_c3a61422.R</span><span class="ansi-red-intense-fg"> (ret=1, workdir=/home/gaow/GIT/dsc2/vignettes/one_sample_location)
[1c24f16d-7e75-4161-bbd6-97c3e35239bb]: [mse_0]: 
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
script_4384414397566502935 in &lt;module&gt;
      ## END code by DSC
      
----&gt; &#34;&#34;&#34;, workdir = &#39;./&#39;, stderr = None, stdout = None)

RuntimeError: Failed to execute commmand </span><span class="ansi-green-fg">Rscript --default-packages=datasets,methods,utils,stats,grDevices,graphics  /home/gaow/GIT/dsc/vignettes/one_sample_location/.sos/mse_0_0_93b09896.R</span><span class="ansi-red-intense-fg"> (ret=1, workdir=/home/gaow/GIT/dsc2/vignettes/one_sample_location)
[DSC]: 1 pending step: DSC_0</span>
<span class="ansi-magenta-intense-fg">WARNING</span>: <span class="ansi-magenta-intense-fg">If needed, you can open </span><span class="ansi-green-fg">dsc_result.scripts.html</span><span class="ansi-magenta-intense-fg"> and use </span><span class="ansi-green-fg">ctrl-F</span><span class="ansi-magenta-intense-fg"> to search by file names to trace back problematic chunks of code.</span>
INFO: Elapsed time <span class="ansi-green-fg">11.066</span> seconds.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Same as before, we run:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="err">!</span> <span class="n">Rscript</span> <span class="o">.</span><span class="n">sos</span><span class="o">/</span><span class="n">mse_0_0_93b09896</span><span class="o">.</span><span class="n">R</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Error in mean_est - true_mean : non-numeric argument to binary operator
Execution halted
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and we examine the code by adding a couple of <code>print</code> commands before the line in question:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="c1">## BEGIN code by DSC</span>
<span class="n">DSC_1589D5E6</span> <span class="o">&lt;-</span> <span class="nb">list</span><span class="p">()</span>
<span class="nb">input</span><span class="o">.</span><span class="n">files</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;dsc_result/t_1.rds&#39;</span><span class="p">,</span><span class="s1">&#39;dsc_result/t_1_mean_1.rds&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">files</span><span class="p">))</span> <span class="n">DSC_1589D5E6</span> <span class="o">&lt;-</span> <span class="n">dscrutils</span><span class="p">:::</span><span class="n">merge_lists</span><span class="p">(</span><span class="n">DSC_1589D5E6</span><span class="p">,</span> <span class="n">readRDS</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="n">mean_est</span> <span class="o">&lt;-</span> <span class="n">DSC_1589D5E6</span><span class="err">$</span><span class="n">mean</span>
<span class="n">true_mean</span> <span class="o">&lt;-</span> <span class="n">DSC_1589D5E6</span><span class="err">$</span><span class="n">true_mean</span>
<span class="n">DSC_1589D5E6_tic_pt</span> <span class="o">&lt;-</span> <span class="n">proc</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c1">## END code by DSC</span>

<span class="k">print</span><span class="p">(</span><span class="n">mean_est</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">true_mean</span><span class="p">)</span>
<span class="n">mse</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_est</span><span class="o">-</span><span class="n">true_mean</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>


<span class="c1">## BEGIN code by DSC</span>
<span class="n">saveRDS</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mse</span><span class="o">=</span><span class="n">mse</span><span class="p">,</span> <span class="n">DSC_TIMER</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">DSC_1589D5E6_tic_pt</span><span class="p">),</span> <span class="s1">&#39;dsc_result/t_1_mean_1_mse_1.rds&#39;</span><span class="p">)</span>
<span class="c1">## END code by DSC</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &#34;meow&#34;
[1] 0
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
Error in mean_est - true_mean: non-numeric argument to binary operator
Traceback:
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It looks like <code>mean_est</code>, instead of being a number, is a string <code>meow</code>. Therefore the line <code>mse = (mean_est-true_mean)^2</code> is doomed to fail. We know from the DSC script that <code>mean_est</code> comes from an upstream module ensemble <code>estimate</code>, that somehow returned <code>meow</code> as output. We can also see from this script that the variable comes from one of <code>'dsc_result/t_1.rds','dsc_result/t_1_mean_1.rds'</code>. From our knowledge in the DSC script we know it should come from <code>'dsc_result/t_1_mean_1.rds'</code> the <code>mean</code> module. Therefore there is nothing we can do in the current script to fix the problem.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Debugging-with-upstream-scripts">Debugging with upstream scripts<a class="anchor-link" href="#Debugging-with-upstream-scripts">&#182;</a></h3><p>Now we want to find out what has produced the problematic <code>mean_est</code> variable. That is, we want to find the module instance that generated <code>'dsc_result/t_1_mean_1.rds'</code> from which <code>mean_est</code> is loaded. However the problematic script above did not tell us where this data comes from. This leads us to examine other scripts in the benchmark that leads to the error, in <a href="dsc_result.scripts.html"><code>dsc_result.scripts.html</code></a>.</p>
<p>You can open up <a href="dsc_result.scripts.html">this file</a> in your web browser, and <em>search</em> (<code>ctrl-F</code>) for the phrase <code>dsc_result/t_1_mean_1.rds</code>. This leads you to the following:</p>
<p><img src="../img/debug-tips-1.png" alt="debug-1"></p>
<p>Unsurprisingly, running these code by itself produces no error message -- this is expected because otherwise DSC would have failed at this stage. However we know from previous investigation that the output does not look right. For this example we can spot instantly that the <code>meow</code> string somehow &#128049; replaced the code for location parameter estimation; and we can fix it easily. In practice, one may need to load both this code chunk and the previous <code>.sos/mse_0_0_93b09896.R</code> to an interactive session, fix the code until <code>.sos/mse_0_0_93b09896.R</code> works, and apply the knowledge learned to the original module <code>R/method/mean.R</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Debug-with---target-and---truncate">Debug with <code>--target</code> and <code>--truncate</code><a class="anchor-link" href="#Debug-with---target-and---truncate">&#182;</a></h2><p>It is highly recommanded that these options be used to check the correctness of DSC benchmark as you develop them. Do not run the entire benchmark unless you have checked it bit by bit. <code>--truncate</code> will only run one instance from a module, thus enables running a fraction of DSC benchmark relatively quickly to ensure everthing is correct. Additionally it is suggested that a benchmark be executed module by module using <code>--target</code>: the next module or module ensemble is only attedmpted when there is no obvious problem with the previous module. For example for a DSC benchmark:</p>

<pre><code>DSC:
  define: 
      simulate: normal, t
      estimate: median, mean
  run: simulate * estimate * mse</code></pre>
<p>When the benchmark is tested for the first time, one should at least run the following sequentially:</p>

<pre><code>dcs file.dsc --target normal --truncate
dcs file.dsc --target t --truncate
dcs file.dsc --target "normal * mean" --truncate
dcs file.dsc --target "normal * median" --truncate
dcs file.dsc --target "normal * median * mse" --truncate</code></pre>
<p>This will ensure all module are tested for at least one instance. Then you can run the benchmark knowing that the chances of errors has already been reduced.</p>

<pre><code>dcs file.dsc</code></pre>
<h2 id="Log-files">Log files<a class="anchor-link" href="#Log-files">&#182;</a></h2><p>The run-time information are kept in greater detail in <code>*.log</code> file, when used with verbosity level greater than <code>2</code>. Though typically unnecessary, if you still cannot fix issues at this point it may help re-running benchmark with <code>-v 4</code> and look into the log file for more run-time information to help performing diagnostics.</p>

</div>
</div>
</div>
<hr>
Copyright (c) 2016-2018 <a href="http://home.uchicago.edu/gaow">Gao Wang</a>, <a href="http://stephenslab.uchicago.edu">Matthew Stephens</a>, <a href="https://pcarbo.github.io">Peter Carbonetto</a> and contributors.<br>&nbsp;&nbsp;&nbsp; Except where otherwise noted, this website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.

</div>
</div>
</body>
</html>
