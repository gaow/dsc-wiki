
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="ipynb_website:version" content="0.9.4" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="../css/jt.css">

<link rel="stylesheet" type="text/css" href="../css/toc2.css">

<link href="../site_libs/jqueryui-1.11.4/jquery-ui.css">
<link rel="stylesheet" href="../site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<link rel="stylesheet" href="../site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<link rel="stylesheet"
      href="../site_libs/highlightjs/jnbinder.min.css"
      type="text/css" />

<script src="../site_libs/highlightjs/highlight.dsc.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>

<script src="../js/doc_toc.js"></script>
<script src="../js/docs.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": {
            preferredFont: "TeX",
            availableFonts: ["TeX"],
            styles: {
                scale: 110,
                ".MathJax_Display": {
                    "font-size": "110%",
                }
            }
        }
    });
</script>
<script>
function filterDataFrame(id) {
    var input = document.getElementById("search_" + id);
    var filter = input.value.toUpperCase();
    var table = document.getElementById("dataframe_" + id);
    var tr = table.getElementsByTagName("tr");
    // Loop through all table rows, and hide those who don't match the search query
    for (var i = 1; i < tr.length; i++) {
        for (var j = 0; j < tr[i].cells.length; ++j) {
            var matched = false;
            if (tr[i].cells[j].innerHTML.toUpperCase().indexOf(filter) != -1) {
                tr[i].style.display = "";
                matched = true
                break;
            }
            if (!matched)
                tr[i].style.display = "none";
        }
    }
}
function sortDataFrame(id, n, dtype) {
    var table = document.getElementById("dataframe_" + id);
    var tb = table.tBodies[0]; // use `<tbody>` to ignore `<thead>` and `<tfoot>` rows
    var tr = Array.prototype.slice.call(tb.rows, 0); // put rows into array
    if (dtype === 'numeric') {
        var fn = function(a, b) { 
            return parseFloat(a.cells[n].textContent) <= parseFloat(b.cells[n].textContent) ? -1 : 1;
        }
    } else {
        var fn = function(a, b) {
            var c = a.cells[n].textContent.trim().localeCompare(b.cells[n].textContent.trim()); 
            return c > 0 ? 1 : (c < 0 ? -1 : 0) }
    }
    var isSorted = function(array, fn) {
        if (array.length < 2)
            return 1;
        var direction = fn(array[0], array[1]); 
        for (var i = 1; i < array.length - 1; ++i) {
            var d = fn(array[i], array[i+1]);
            if (d == 0)
                continue;
            else if (direction == 0)
                direction = d;
            else if (direction != d)
                return 0;
            }
        return direction;
    }
    var sorted = isSorted(tr, fn);
    if (sorted == 1 || sorted == -1) {
        // if sorted already, reverse it
        for(var i = tr.length - 1; i >= 0; --i)
            tb.appendChild(tr[i]); // append each row in order
    } else {
        tr = tr.sort(fn);
        for(var i = 0; i < tr.length; ++i)
            tb.appendChild(tr[i]); // append each row in order
    }
}
</script>

<script>
$( document ).ready(function(){
            var cfg={'threshold':3,     // depth of toc (number of levels)
             'number_sections': false,
             'toc_cell': false,          // useless here
             'toc_window_display': true, // display the toc window
             "toc_section_display": "block", // display toc contents in the window
             'sideBar':true,       // sidebar or floating window
             'navigate_menu':false       // navigation menu (only in liveNotebook -- do not change)
            }
            var st={};                  // some variables used in the script
            st.rendering_toc_cell = false;
            st.config_loaded = false;
            st.extension_initialized=false;
            st.nbcontainer_marginleft = $('#notebook-container').css('margin-left')
            st.nbcontainer_marginright = $('#notebook-container').css('margin-right')
            st.nbcontainer_width = $('#notebook-container').css('width')
            st.oldTocHeight = undefined
            st.cell_toc = undefined;
            st.toc_index=0;
            // fire the main function with these parameters
            table_of_contents(cfg, st);
            var file=tutorialsDict[$("h1:first").attr("id")];
            $("#toc-level0 a").css("color","#126dce");
            $('a[href="#'+$("h1:first").attr("id")+'"]').hide()
            var docs=tutorialsArray;
            var docs_map=tutorialsArrayMap;
            var pos=tutorialsArray.indexOf(file);
            for (var a=pos;a>=0;a--){
                  $('<li><a href="'+docs[a]+'.html"><font color="#073642"><b>'+docs_map[docs[a]].replace(/_/g," ")+'</b></font></a></li>').insertBefore("#toc-level0 li:eq(0)");
            }
            $('a[href="'+file+'.html'+'"]').css("color","#126dce");
            for (var a=pos+1;a<docs.length;a++){
                  $(".toc #toc-level0").append('<li><a href="'+docs[a]+'.html"><font color="#073642"><b>'+docs_map[docs[a]].replace(/_/g," ")+'</b></font></a></li>');
            }
            // $("#toc-header").hide(); // comment out because it prevents search bar from displaying
    });
</script>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');
  // mark it active
  menuAnchor.parent().addClass('active');
  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>
<div class="container-fluid main-container">
<!-- tabsets -->
<script src="../site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>



<title>Dynamic Statistical Comparisons</title>

<style type = "text/css">
body {
  font-family: "Droid Sans";
  padding-top: 66px;
  padding-bottom: 40px;
}
</style>
</head>

<body>
<div tabindex="-1" id="notebook" class="border-box-sizing">
<div class="container" id="notebook-container">

<!-- code folding -->

<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Dynamic Statistical Comparisons</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
<li>
  <a href="../index.html">Home</a>
</li>
        
<li>
  <a href="../tutorials.html">Tutorials</a>
</li>
        
<li>
  <a href="../installation.html">Installation</a>
</li>
        
<li>
  <a href="../FAQ.html">FAQ</a>
</li>
        
<li>
  <a href="../examples.html">Examples</a>
</li>
        
<li>
  <a href="../reference.html">Reference</a>
</li>
        
      </ul>
        
<ul class="nav navbar-nav navbar-right">
<li>
   <a href="https://github.com/stephenslab/dsc"> <span class="fa fa-github"></span> </a>
</li>
</ul>
        
      </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="DSC-Basics,-Part-II">DSC Basics, Part II<a class="anchor-link" href="#DSC-Basics,-Part-II">&#182;</a></h1><p>This is the second part of the "DSC Basics" tutorial. Before working through this tutorial, you should have already read <a href="Intro_Syntax_I.html">DSC Basics, Part I</a>. Here we build on the mean estimation example from the previous part to illustrate new concepts and syntax in DSC, with an emphasis on the use of <em>module parameters</em>.</p>
<p>Materials used in this tutorial can be found in the <a href="https://github.com/stephenslab/dsc/tree/master/vignettes/one_sample_location">DSC vignettes repository</a>. As before, you may choose to run this example DSC program as you read through the tutorial, but this is not required. For more details, consult the README in the <a href="https://github.com/stephenslab/dsc/tree/master/vignettes/one_sample_location">"one sample location" DSC vignette</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Defining-a-module-parameter">Defining a module parameter<a class="anchor-link" href="#Defining-a-module-parameter">&#182;</a></h2><p>In our example DSC, recall we defined the <code>normal</code> module as follows:</p>

<pre><code>normal: R(x &lt;- rnorm(n = 100,mean = 0,sd = 1))
  $data: x
  $true_mean: 0</code></pre>
<p>In defining this module, we made an unfortunate design decision: the mean used to simulate the data was defined twice: once inside the call to <code>rnorm</code>, where we set <code>mean = 0</code>, and once when we set the module output <code>$true_mean</code> to zero. If we decided to use a different mean to simulate the data, then we would have to be careful to change the code in two different places, otherwise this would lead to downstream errors.</p>
<p>It would be better if the mean of the data were defined once. In DSC, this can be accomplished with a <em>module parameter</em>:</p>

<pre><code>normal: R(x &lt;- rnorm(n = 100,mean = mu,sd = 1))
  mu: 0
  $data: x
  $true_mean: mu</code></pre>
<p>Here, we define a module parameter <code>mu</code>, and set its value zero. Once we have defined <code>mu</code>, any of the R code and module outputs inside the <code>normal</code> module may refer to this module parameter. In this example, the second argument of <code>rnorm</code> is set to the value of <code>mu</code>, and the module output <code>$true_mean</code> is also set to the value of <code>mu</code>.</p>
<p>With this change to the module definition, modifying the mean used to simulate the data only requires editing one line of code instead of two.</p>
<p>Likewise, we can use a module parameter to specify the mean of the data simulated from a $t$ distribution:</p>

<pre><code>t: R(x &lt;- mu + rt(n = 100,df = 2))
  mu: 3
  $data: x
  $true_mean: mu</code></pre>
<p>Note that there is no requirement that the module parameters for the <code>normal</code> and <code>t</code> modules have the same name, <code>mu</code>, but in this case makes sense to do so. One advantage of defining parameters with the same name is that makes it easier to query the results.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-order-of-evaluation-inside-a-module">The order of evaluation inside a module<a class="anchor-link" href="#The-order-of-evaluation-inside-a-module">&#182;</a></h2><p>Below, we will give some more elaborate examples with module parameters. Before continuing, it is important to keep in mind these two points:</p>
<ul>
<li><p>A module parameter cannot depend on any of the module inputs, and it can only depend on other module parameters through use of the <code>raw</code> keyword (this is explained below). In other words, it must be possible to evaluate the module parameter without knowing the values of the module inputs or the values of the other module parameters (except when <code>raw</code> is used).</p>
</li>
<li><p>Module parameters are evaluated before the module script (except when <code>raw</code> is used—see below). The exact procedure for evaluating a module is as follows:</p>
<ol>
<li><p>Evaluate any R code used to determine the values of the module parameters (we give an example of this below).</p>
</li>
<li><p>Set the values of the module parameters (except for module parameters defined with <code>raw</code>).</p>
</li>
<li><p>Initialize the module inputs according to the current stored values of the pipeline variables.</p>
</li>
<li><p>For each module parameter and module input, define a script variable in the global environment with the same name and same value as the  module parameter or input.</p>
</li>
<li><p>Evaluate the module script or inline source code. All script variables—that is, all variable defined within the global environment in which the script is evaluated—are retained for resolving any module outputs.</p>
</li>
<li><p>Set each module output to the stored value of the selected script variable.</p>
</li>
</ol>
</li>
</ul>
<p>If this evaluation procedure is unclear to you at this stage, it will will become more clear as we work through the examples below.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="A-single-module-parameter-with-multiple-alternative-values">A single module parameter with multiple alternative values<a class="anchor-link" href="#A-single-module-parameter-with-multiple-alternative-values">&#182;</a></h2><p>In the example above, we showed that module parameters are useful for simplifying a module definition by defining a variable that is used in multiple places inside the module. Here we will see that module parameters have another powerful use: they can be used to define multiple similar modules.</p>
<p>Currently, in the <code>normal</code> module, we simulate 100 random samples from a normal distribution. Suppose we would like to define a second module that simulates 1,000 random samples from the same normal distribution. This is easily done by defining a new module parameter <code>n</code> that takes on two different values:</p>

<pre><code>normal: R(x &lt;- rnorm(n,mean = mu,sd = 1))
  mu: 0
  n: 100, 1000
  $data: x
  $true_mean: mu</code></pre>
<p>The comma delimits the two possible values of model parameter <code>n</code>.</p>
<p>Now that we have defined <code>n</code> inside this module, we can refer to this module parameter inside the R code that simulates random draws from a normal distribution—specifically, as in the example above.</p>
<p>This module definition is equivalent to defining two modules, <code>normal_100</code> and <code>normal_1000</code>, that are identical in every way except that the first module includes parameter definition <code>n: 100</code> and the second defines <code>n: 100</code>. The code above is of course much more succinct.</p>
<p>The definition of <code>n</code> should not be interpreted as a vector or sequence with two entries, 100 and 1000. Instead, it should be understood as defining a <em>set of alternative values</em>, in which <code>n</code> within any given module is set to either 100 or 1000. To put it another way, <code>n: 100, 1000</code> defines two <em>alternative values</em> for module parameter <code>n</code>, and therefore defines two <em>alternative modules</em> <code>normal</code> that are the same in every way except for the setting of <code>n</code>.</p>
<p>A distinguishing property of module parameters with multiple alternative values is that <em>their order does not matter</em>. For example, if we instead wrote <code>n: 1000, 100</code>, <em>the DSC results will be exactly the same as</em> <code>n: 100, 1000</code>. (The only thing that will change is the order in which the results will appear in the tables, and the way in which the results are stored in files.)</p>
<p>Now that we have defined two <code>normal</code> modules, there is also the question of how the outputs from the two different modules can be distinguished in the results; for example, you may want to compare the accuracy of the estimates in the larger (<code>n = 1000</code>) and smaller (<code>n = 100</code>) simulated data sets. Next we will see that the results from these two modules can be distinguished by the stored value of the module parameter <code>n</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Executing-the-DSC-with-alternative-simulate-modules">Executing the DSC with alternative <code>simulate</code> modules<a class="anchor-link" href="#Executing-the-DSC-with-alternative-simulate-modules">&#182;</a></h2><p>Let's go ahead and generate results from our new "mean estimation" DSC. In the new DSC, we define the <code>simulate</code> modules as follows:</p>

<pre><code>normal: R(x &lt;- rnorm(n,mean = mu,sd = 1))
  mu: 0
  n: 100, 1000
  $data: x
  $true_mean: mu

t: R(x &lt;- mu + rt(n,df = 2))
  mu: 3
  n: 100, 1000
  $data: x
  $true_mean: mu</code></pre>
<p>The rest of the DSC remains unchanged from before.</p>
<p>This new DSC is implemeted by <code>simulate_data_twice.dsc</code> inside the <code>one_sample_location</code> vignette folder.</p>
<p>To run the DSC benchmark, change the working directory (here we have assumed that the dsc repository is stored in the <code>git</code> subdirectory of your home directory),</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">git</span><span class="o">/</span><span class="n">dsc</span><span class="o">/</span><span class="n">vignettes</span><span class="o">/</span><span class="n">one_sample_location</span>
<span class="n">pwd</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/pcarbo/git/dsc/vignettes/one_sample_location
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>remove any previously generated results,</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">Rf</span> <span class="n">first_investigation</span><span class="o">.</span><span class="n">html</span> <span class="n">first_investigation</span><span class="o">.</span><span class="n">log</span> <span class="n">first_investigation</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>then let's run 10 replicates of all the pipelines:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">dsc</span> <span class="n">simulate_data_twice</span><span class="o">.</span><span class="n">dsc</span> <span class="o">--</span><span class="n">replicate</span> <span class="mi">10</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>INFO: DSC script exported to <span class="ansi-green-fg">first_investigation.html</span>
INFO: Constructing DSC from <span class="ansi-green-fg">simulate_data_twice.dsc</span> ...
INFO: Building execution graph &amp; running DSC ...
DSC: 100%|██████████████████████████████████████| 15/15 [00:47&lt;00:00,  2.37s/it]
INFO: Building DSC database ...
INFO: DSC complete!
INFO: Elapsed time <span class="ansi-green-fg">49.815</span> seconds.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>TO DO: Add a sentence here pointing out the number of module outputs that were generated by this command.</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Inspecting-the-DSC-results-with-n=100-and-n=1000">Inspecting the DSC results with <code>n=100</code> and <code>n=1000</code><a class="anchor-link" href="#Inspecting-the-DSC-results-with-n=100-and-n=1000">&#182;</a></h2><p>Now we will view the DSC results in R. Change the R working directory to the location of the DSC file, and use the dscquery function from the <code>dscrutils</code> package to load the DSC results into R:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">setwd</span><span class="p">(</span><span class="s2">&quot;~/git/dsc/vignettes/one_sample_location&quot;</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dscrutils</span><span class="p">)</span>
<span class="n">dscout</span> <span class="o">&lt;-</span>
  <span class="n">dscquery</span><span class="p">(</span><span class="n">dsc</span><span class="o">.</span><span class="n">outdir</span> <span class="o">=</span> <span class="s2">&quot;first_investigation&quot;</span><span class="p">,</span>
           <span class="n">targets</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;simulate.n&quot;</span><span class="p">,</span><span class="s2">&quot;analyze&quot;</span><span class="p">,</span><span class="s2">&quot;score.error&quot;</span><span class="p">))</span>
<span class="n">nrow</span><span class="p">(</span><span class="n">dscout</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Running shell command:
dsc-query first_investigation -o /var/folders/9b/ck4lp8s140lcksryyh4dppdr0000gn/T//RtmpU40I0r/file5f34164f5246.csv -f --target simulate.n simulate.true_mean analyze score.error 
Loading dsc-query output from CSV file.
Reading DSC outputs:
 - simulate.true_mean: extracted atomic values
 - score.error: extracted atomic values
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
160
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The DSC command we ran above generated results for 10 replicates of 16 pipelines, doubling the number of pipelines we had before. This is expected because we now have 4 <code>simulate</code> modules (2 <code>normal</code> modules and 2 <code>t</code> modules), whereas before we had 2 <code>simulate</code> modules. To confirm this, we see that each of the <code>simulate</code> modules is run 40 times:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="k">with</span><span class="p">(</span><span class="n">dscout</span><span class="p">,</span><span class="n">table</span><span class="p">(</span><span class="n">simulate</span><span class="p">,</span><span class="n">simulate</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>        simulate.n
simulate 100 1000
  normal  40   40
  t       40   40</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We would expect that estimates improve with more data. We can quickly check this by comparing the average error (e.g., the squared error) in the pipelines with 100 samples against the average error in the pipelines with 1000 samples:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">dat</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">dscout</span><span class="p">,</span><span class="n">score</span> <span class="o">==</span> <span class="s2">&quot;sq_err&quot;</span><span class="p">)</span>
<span class="k">as</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">by</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span>
            <span class="k">with</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">analyze</span><span class="p">,</span><span class="n">simulate</span><span class="o">.</span><span class="n">n</span><span class="p">)),</span>
            <span class="n">function</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="err">$</span><span class="n">score</span><span class="o">.</span><span class="n">error</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>            100     1000
mean   0.308991 0.004709
median 0.015792 0.002163</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Indeed, based on the results from these 10 replicates, we see that the accuracy of both methods (mean and median) improves considerably with more data, on average, and in both cases the median is more accurate than the mean on average.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Two-module-parameters-with-multiple-alternatives">Two module parameters with multiple alternatives<a class="anchor-link" href="#Two-module-parameters-with-multiple-alternatives">&#182;</a></h2><p>If you provide more than one value for multiple module parameters, DSC considers all combinations of the values.</p>
<p>For example, suppose we want to evaluate estimators of the population mean when the data are simulated from the <em>t</em> distribution with different numbers of degrees of freedom. In DSC, this can be compactly expressed by defining another module parameter, <code>df</code>, with multiple values:</p>

<pre><code>t: R(x &lt;- mu + rt(n,df))
  mu: 3
  df: 2, 4, 10
  n: 100, 1000
  $data: x
  $true_mean: mu</code></pre>
<p>This defines 6 <code>t</code> modules from the 6 different ways of setting both the <code>n</code> and <code>df</code> parameters.</p>
<p>Next, let's clear the previous results and run the new DSC benchmark:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">Rf</span> <span class="n">first_investigation</span><span class="o">.</span><span class="n">html</span> <span class="n">first_investigation</span><span class="o">.</span><span class="n">log</span> <span class="n">first_investigation</span>
<span class="n">dsc</span> <span class="n">simulate_multiple_dfs</span><span class="o">.</span><span class="n">dsc</span> <span class="o">--</span><span class="n">replicate</span> <span class="mi">10</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>INFO: DSC script exported to <span class="ansi-green-fg">first_investigation.html</span>
INFO: Constructing DSC from <span class="ansi-green-fg">simulate_multiple_dfs.dsc</span> ...
INFO: Building execution graph &amp; running DSC ...
DSC: 100%|██████████████████████████████████████| 15/15 [01:55&lt;00:00,  6.08s/it]
INFO: Building DSC database ...
INFO: DSC complete!
INFO: Elapsed time <span class="ansi-green-fg">118.543</span> seconds.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>TO DO: Add a sentence here pointing out the number of module outputs that were generated by this command.</em></p>
<p>Now let's load all the results generated with the <em>t</em>-simulated data:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="n">dscout2</span> <span class="o">&lt;-</span>
  <span class="n">dscquery</span><span class="p">(</span><span class="n">dsc</span><span class="o">.</span><span class="n">outdir</span> <span class="o">=</span> <span class="s2">&quot;first_investigation&quot;</span><span class="p">,</span>
           <span class="n">targets</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;t.n&quot;</span><span class="p">,</span><span class="s2">&quot;t.df&quot;</span><span class="p">,</span><span class="s2">&quot;analyze&quot;</span><span class="p">,</span><span class="s2">&quot;score.error&quot;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Running shell command:
dsc-query first_investigation -o /var/folders/9b/ck4lp8s140lcksryyh4dppdr0000gn/T//RtmpU40I0r/file5f343992f15b.csv -f --target t.n t.df analyze score.error 
Loading dsc-query output from CSV file.
Reading DSC outputs:
 - score.error: extracted atomic values
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In total, we have results from 240 pipelines:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-sos"><pre><span></span><span class="k">with</span><span class="p">(</span><span class="n">dscout2</span><span class="p">,</span><span class="n">table</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="o">.</span><span class="n">df</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>      t.df
t.n     2  4 10
  100  40 40 40
  1000 40 40 40</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Each of the 6 <code>t</code> modules was run 40 times: 2 analyze modules x 2 score modules x 10 replicates.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-a-module-parameter-to-set-the-seed">Using a module parameter to set the seed<a class="anchor-link" href="#Using-a-module-parameter-to-set-the-seed">&#182;</a></h2><p>To ensure reproduceable results, it is often necessary to initialize the state, or "seed", for generating the sequence of pseudorandom numbers. DSC automatically provides a default setting for the seed in R, but you may want to override this choice. A common use of module parameters is to modules with different seeds.</p>
<p>In this example, we define 10 modules that generate normally distributed data sets with 100 samples:</p>

<pre><code>normal: R(set.seed(seed); x &lt;- rnorm(n,mean = mu,sd = 1))
  seed: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
  mu: 0
  n: 100
  $data: x
  $true_mean: mu</code></pre>
<p>The only difference in the 10 <code>normal</code> modules is the sequence of pseudorandom numbers used to simulate random draws from the normal distribution.</p>
<p>See <code>multiple_seeds.dsc</code> in the <code>one_sample_location</code> directory for a working example.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Combining-module-parameters-with-module-inputs">Combining module parameters with module inputs<a class="anchor-link" href="#Combining-module-parameters-with-module-inputs">&#182;</a></h2><p>It is also possible to combine module parameters with module inputs.</p>
<p>Recall, in the <a href="Intro_DSC.html">introductory tutorial</a> we defined a third <code>analyze</code> module that implemented the "Winsorized" mean. The <code>trim</code> argument to <code>winsor.mean</code> determines the proportion of the data to "squish" from the top and bottom of the distributions. If we wanted to evaluate the impact that the trimming amount has on the accuracy of the estimate, we could introduce a module parameter <code>trim</code> with multiple settings:</p>

<pre><code>winsor: R(y &lt;- psych::winsor.mean(x,trim,na.rm = TRUE))
  trim: 0.1, 0.2
  x: $data
  $est_mean: y</code></pre>
<p>For each data set generated by a <code>simulate</code> module, DSC will run two different <code>winsor</code> modules: one with <code>trim = 0.1</code>, and a second with <code>trim = 0.2</code>.</p>
<p>Intuitively, one may want to adjust the trim setting <em>dynamically</em> based on the data (e.g., based on the fit to the normal distribution). However, this is not possible in DSC because module parameters must be set independently of the module inputs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Defining-more-complex-module-parameters-(incomplete)">Defining more complex module parameters (incomplete)<a class="anchor-link" href="#Defining-more-complex-module-parameters-(incomplete)">&#182;</a></h2><p>Above, we showed that DSC defines a module for each combination of the module parameters. Sometimes it is desirable to have finer control over which combinations are module parameters are used. One way to do this is to define a single module parameter that sets the value of multiple parameters used in the script. For example, suppose we wanted to simulate data from <em>t</em> distributions with these three settings of the mean (<code>mu</code>) and number of degrees of freedom (<code>df</code>):</p>

<pre><code>mu  df
--  --
 0   2
 1   2
 2   4</code></pre>
<p>This cannot be achieved by setting the module parameters <code>mu</code> and <code>df</code> separately because it will automatically define modules for all combinations of <code>mu</code> and <code>df</code>. Instead, we can do something like this:</p>

<pre><code>t: R(mu &lt;- par[1]; df &lt;- par[2]; x &lt;- mu + rt(n,df))
  par: R(c(mu = 0,df = 2)),
       R(c(mu = 1,df = 2)),
       R(c(mu = 2,df = 4))
  n: 100
  $data: x
  $true_mean: 3</code></pre>
<p>In this example, <code>par</code> is a module parameter with 3 alternative settings, in which each alternative setting is a vector with two elements; the first vector element is the mean of the simulated data, and the second vector element is the number of degrees of freedom.</p>
<p>Note that the text inside the <code>R()</code> is evaluated as R code.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Defining-module-parameters-with-many-alternative-values-(incomplete)">Defining module parameters with many alternative values (incomplete)<a class="anchor-link" href="#Defining-module-parameters-with-many-alternative-values-(incomplete)">&#182;</a></h2><p>Example for this section:</p>
<p>Start with an example in which the different values of n are 10^1, 10^1.5, 10^2, etc, all defined within R().</p>
<p>Then generate many simulated data sets with different values of n, from very small (10) to very large (1e6) using R{}.</p>
<p>Finally, run the code and show that it works.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Recap">Recap<a class="anchor-link" href="#Recap">&#182;</a></h2><p>Add recap here.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Exploring-further">Exploring further<a class="anchor-link" href="#Exploring-further">&#182;</a></h2><p>In this tutorial, we introduced the most essential features of DSC that are sufficient to . There are many other features of DSC that we did not have a chance to mention in these introductory tutorial.</p>

</div>
</div>
</div>
<hr>
Copyright (c) 2016-2018 <a href="http://home.uchicago.edu/gaow">Gao Wang</a>, <a href="http://stephenslab.uchicago.edu">Matthew Stephens</a>, <a href="https://pcarbo.github.io">Peter Carbonetto</a> and contributors.<br>&nbsp;&nbsp;&nbsp; Except where otherwise noted, this website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.

</div>
</div>
</body>
</html>
