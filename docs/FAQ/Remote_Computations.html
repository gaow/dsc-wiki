
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="ipynb_website:version" content="0.9.4" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="../css/jt.css">

<link rel="stylesheet" type="text/css" href="../css/toc2.css">

<link href="../site_libs/jqueryui-1.11.4/jquery-ui.css">
<link rel="stylesheet" href="../site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<link rel="stylesheet" href="../site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<link rel="stylesheet"
      href="../site_libs/highlightjs/jnbinder.min.css"
      type="text/css" />

<script src="../site_libs/highlightjs/highlight.dsc.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>

<script src="../js/doc_toc.js"></script>
<script src="../js/docs.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": {
            preferredFont: "TeX",
            availableFonts: ["TeX"],
            styles: {
                scale: 110,
                ".MathJax_Display": {
                    "font-size": "110%",
                }
            }
        }
    });
</script>
<script>
function filterDataFrame(id) {
    var input = document.getElementById("search_" + id);
    var filter = input.value.toUpperCase();
    var table = document.getElementById("dataframe_" + id);
    var tr = table.getElementsByTagName("tr");
    // Loop through all table rows, and hide those who don't match the search query
    for (var i = 1; i < tr.length; i++) {
        for (var j = 0; j < tr[i].cells.length; ++j) {
            var matched = false;
            if (tr[i].cells[j].innerHTML.toUpperCase().indexOf(filter) != -1) {
                tr[i].style.display = "";
                matched = true
                break;
            }
            if (!matched)
                tr[i].style.display = "none";
        }
    }
}
function sortDataFrame(id, n, dtype) {
    var table = document.getElementById("dataframe_" + id);
    var tb = table.tBodies[0]; // use `<tbody>` to ignore `<thead>` and `<tfoot>` rows
    var tr = Array.prototype.slice.call(tb.rows, 0); // put rows into array
    if (dtype === 'numeric') {
        var fn = function(a, b) { 
            return parseFloat(a.cells[n].textContent) <= parseFloat(b.cells[n].textContent) ? -1 : 1;
        }
    } else {
        var fn = function(a, b) {
            var c = a.cells[n].textContent.trim().localeCompare(b.cells[n].textContent.trim()); 
            return c > 0 ? 1 : (c < 0 ? -1 : 0) }
    }
    var isSorted = function(array, fn) {
        if (array.length < 2)
            return 1;
        var direction = fn(array[0], array[1]); 
        for (var i = 1; i < array.length - 1; ++i) {
            var d = fn(array[i], array[i+1]);
            if (d == 0)
                continue;
            else if (direction == 0)
                direction = d;
            else if (direction != d)
                return 0;
            }
        return direction;
    }
    var sorted = isSorted(tr, fn);
    if (sorted == 1 || sorted == -1) {
        // if sorted already, reverse it
        for(var i = tr.length - 1; i >= 0; --i)
            tb.appendChild(tr[i]); // append each row in order
    } else {
        tr = tr.sort(fn);
        for(var i = 0; i < tr.length; ++i)
            tb.appendChild(tr[i]); // append each row in order
    }
}
</script>

<script>
$( document ).ready(function(){
            var cfg={'threshold':3,     // depth of toc (number of levels)
             'number_sections': false,
             'toc_cell': false,          // useless here
             'toc_window_display': true, // display the toc window
             "toc_section_display": "block", // display toc contents in the window
             'sideBar':true,       // sidebar or floating window
             'navigate_menu':false       // navigation menu (only in liveNotebook -- do not change)
            }
            var st={};                  // some variables used in the script
            st.rendering_toc_cell = false;
            st.config_loaded = false;
            st.extension_initialized=false;
            st.nbcontainer_marginleft = $('#notebook-container').css('margin-left')
            st.nbcontainer_marginright = $('#notebook-container').css('margin-right')
            st.nbcontainer_width = $('#notebook-container').css('width')
            st.oldTocHeight = undefined
            st.cell_toc = undefined;
            st.toc_index=0;
            // fire the main function with these parameters
            table_of_contents(cfg, st);
            var file=FAQDict[$("h1:first").attr("id")];
            $("#toc-level0 a").css("color","#126dce");
            $('a[href="#'+$("h1:first").attr("id")+'"]').hide()
            var docs=FAQArray;
            var docs_map=FAQArrayMap;
            var pos=FAQArray.indexOf(file);
            for (var a=pos;a>=0;a--){
                  $('<li><a href="'+docs[a]+'.html"><font color="#073642"><b>'+docs_map[docs[a]].replace(/_/g," ")+'</b></font></a></li>').insertBefore("#toc-level0 li:eq(0)");
            }
            $('a[href="'+file+'.html'+'"]').css("color","#126dce");
            for (var a=pos+1;a<docs.length;a++){
                  $(".toc #toc-level0").append('<li><a href="'+docs[a]+'.html"><font color="#073642"><b>'+docs_map[docs[a]].replace(/_/g," ")+'</b></font></a></li>');
            }
            // $("#toc-header").hide(); // comment out because it prevents search bar from displaying
    });
</script>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');
  // mark it active
  menuAnchor.parent().addClass('active');
  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>
<div class="container-fluid main-container">
<!-- tabsets -->
<script src="../site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>



<title>Dynamic Statistical Comparisons</title>

<style type = "text/css">
body {
  font-family: "Droid Sans";
  padding-top: 66px;
  padding-bottom: 40px;
}
</style>
</head>

<body>
<div tabindex="-1" id="notebook" class="border-box-sizing">
<div class="container" id="notebook-container">

<!-- code folding -->

<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Dynamic Statistical Comparisons</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
<li>
  <a href="../index.html">Home</a>
</li>
        
<li>
  <a href="../tutorials.html">Tutorials</a>
</li>
        
<li>
  <a href="../installation.html">Installation</a>
</li>
        
<li>
  <a href="../FAQ.html">FAQ</a>
</li>
        
<li>
  <a href="../examples.html">Examples</a>
</li>
        
<li>
  <a href="../reference.html">Reference</a>
</li>
        
      </ul>
        
<ul class="nav navbar-nav navbar-right">
<li>
   <a href="https://github.com/stephenslab/dsc"> <span class="fa fa-github"></span> </a>
</li>
</ul>
        
      </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Running-DSC-on-a-remote-computer">Running DSC on a remote computer<a class="anchor-link" href="#Running-DSC-on-a-remote-computer">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview">Overview<a class="anchor-link" href="#Overview">&#182;</a></h2><p>DSC uses one additional configuration file and two command options (<code>--host</code> and <code>--to-host</code>) to run on a remote computer (or "host", hereafter). Here a remote computer can be:</p>
<ol>
<li>A standalone desktop workstation without a job queue system</li>
<li>A system with a job queue manager, such as PBS-based cluster</li>
</ol>
<p>DSC facilicate two approaches to run remote tasks:</p>
<ol>
<li>"On-Host", the conventional way: log in to the host and run remote jobs. For a standalone system, this is no difference from logging in to the system and run DSC benchmark directly. For a cluster system this will automatically submit jobs to compute nodes based on provided template.</li>
<li>"Local-Host", a host friendly way: do not log in to the host to run jobs. Rather, have a copy of DSC software installed to your local computer (Mac or Linux), and configure the host to have DSC and all required tools for benchmarking installed. Then run DSC from local computer with additional folders to be synced to the host specified by <code>--to-host</code> option. The local computer will serve as the job dispatcher and job monitor. This provides a way to run on hosts that has some policy constraints on long running jobs from the headnode, for example.</li>
</ol>
<p>Under the hood, DSC configures all modules and converts them to <a href="https://vatlab.github.io/sos-docs"><code>SoS</code></a> tasks. Enthusiastic readers shall refer to <a href="https://vatlab.github.io/sos-docs/doc/documentation/Remote_Execution.html">this page</a> for details under the hood. Configuration here in DSC is further automated for benchmarking and thus simpler interface-wise.</p>
<p>In this tutorial we'll focus on discussing running jobs on a cluster with queue manager.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Job-configuration-template-and-command-options">Job configuration template and command options<a class="anchor-link" href="#Job-configuration-template-and-command-options">&#182;</a></h2><p>Using a template and command options, DSC allows users to:</p>
<ol>
<li>Configure job submission on host.</li>
<li>Configure resource requirement per module.</li>
</ol>
<p>Using command options, users can</p>
<ol>
<li>Submit the entire benchmark with controlled maximum job limits (command option <code>-c</code>).</li>
<li>When submitting from local to host computer, automatically send required files to the host for benchmarking (command option <code>--to-host</code>).</li>
</ol>
<p>Users can also use SoS utility tools to manage jobs. The end of documentation will briefly discuss a few SoS utility commands with examples.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Host-configuration-example">Host configuration example<a class="anchor-link" href="#Host-configuration-example">&#182;</a></h2><p>DSC command option <code>--host</code> accepts a YAML configuration file that specifies a <em>template</em> for remote jobs. <strong>We provide support to such configuration files on need-basis</strong>, because we (the DSC developers) can only verify and ensure the it works on system that we have access to and use on regular basis. For example, <a href="https://github.com/stephenslab/dsc-reg/blob/master/midway.yml">here is a template</a> for a system running PBS type of queue via Slurm Workload Manage:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">DSC</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">midway2</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">UChicago RCC cluster Midway 2</span>
    <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
    <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">home</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/gaow</span>
    <span class="l l-Scalar l-Scalar-Plain">queue_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">pbs</span>
    <span class="l l-Scalar l-Scalar-Plain">status_check_interval</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
    <span class="l l-Scalar l-Scalar-Plain">max_running_jobs</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">40</span>
    <span class="l l-Scalar l-Scalar-Plain">max_cores</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">40</span>
    <span class="l l-Scalar l-Scalar-Plain">max_walltime</span><span class="p p-Indicator">:</span> <span class="s">&quot;36:00:00&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">max_mem</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">64G</span>
    <span class="l l-Scalar l-Scalar-Plain">job_template</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
      <span class="no">#!/bin/bash</span>
      <span class="no">#SBATCH --time={walltime}</span>
      <span class="no">#{partition}</span>
      <span class="no">#{account}</span>
      <span class="no">#SBATCH --nodes=1</span>
      <span class="no">#SBATCH --ntasks-per-node={cores}</span>
      <span class="no">#SBATCH --mem-per-cpu={mem//10**9}G</span>
      <span class="no">#SBATCH --job-name={job_name}</span>
      <span class="no">#SBATCH --output={cur_dir}/.sos/{job_name}.stdout</span>
      <span class="no">#SBATCH --error={cur_dir}/.sos/{job_name}.stderr</span>
      <span class="no">cd {cur_dir}</span>
      <span class="no">module load R/3.4.3</span>
    <span class="l l-Scalar l-Scalar-Plain">partition</span><span class="p p-Indicator">:</span> <span class="s">&quot;SBATCH</span><span class="nv"> </span><span class="s">--partition=broadwl&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">account</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">submit_cmd</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sbatch {job_file}</span>
    <span class="l l-Scalar l-Scalar-Plain">submit_cmd_output</span><span class="p p-Indicator">:</span> <span class="s">&quot;Submitted</span><span class="nv"> </span><span class="s">batch</span><span class="nv"> </span><span class="s">job</span><span class="nv"> </span><span class="s">{job_id}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">status_cmd</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">squeue --job {job_id}</span>
    <span class="l l-Scalar l-Scalar-Plain">kill_cmd</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">scancel {job_id}</span>
  <span class="l l-Scalar l-Scalar-Plain">faraway2</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">based_on</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">midway2</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Submit and manage jobs to `midway2` from a local computer.</span>
    <span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gaow@midway2.rcc.uchicago.edu</span>
  <span class="l l-Scalar l-Scalar-Plain">stephenslab</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">based_on</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">midway2</span>
    <span class="l l-Scalar l-Scalar-Plain">max_cores</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">28</span>
    <span class="l l-Scalar l-Scalar-Plain">max_mem</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">128G</span>
    <span class="l l-Scalar l-Scalar-Plain">max_walltime</span><span class="p p-Indicator">:</span> <span class="s">&quot;10d&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">partition</span><span class="p p-Indicator">:</span> <span class="s">&quot;SBATCH</span><span class="nv"> </span><span class="s">--partition=mstephens&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">account</span><span class="p p-Indicator">:</span> <span class="s">&quot;SBATCH</span><span class="nv"> </span><span class="s">--account=pi-mstephens&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">queue</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">midway2</span>
  <span class="l l-Scalar l-Scalar-Plain">time_per_instance</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
  <span class="l l-Scalar l-Scalar-Plain">instances_per_job</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="l l-Scalar l-Scalar-Plain">n_cpu</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="l l-Scalar l-Scalar-Plain">mem_per_cpu</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2G</span>

<span class="c1"># module specific configurations</span>
<span class="c1"># mostly to consolidate small jobs</span>
<span class="l l-Scalar l-Scalar-Plain">simulate</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">instances_per_job</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>

<span class="l l-Scalar l-Scalar-Plain">score</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">instances_per_job</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The section <code>DSC</code> is required to provide various templates for a number of systems. Here <code>midway2</code> is a host provided by <a href="https://rcc.uchicago.edu">The University of Chicago RCC group</a>. Jobs are submitted to <code>partition=broadwl</code>. Typically it has 40 cores per node, allows for maximum of 40 concurrent jobs per user, and a maximum running time of 36hrs per job. These limitations have been reflected by the <code>max_*</code> values in the configuration.</p>
<p>There are also 2 "derived" queue: <code>stephenslab</code> is a special partition on <code>midway2</code> that allows for different configurations, thus it is derived from <code>midway2</code> via <code>based_on: midway2</code>. Also relevant is the <code>faraway2</code>, also <code>based_on: midway2</code>, but specifies the address of how to connect to <code>midway2</code>. Then DSC will assume that the request is made from a local computer and try to use the "local-host" mechanism to run jobs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The section <code>default</code> is also required. It provides default settings for all modules in the DSC. Available settings are:</p>
<ul>
<li><code>queue</code>: name of the queue on the remote host to use, one of the various queues defined in <code>DSC</code> section.<ul>
<li>Here in the template it is set to <code>midway2</code>, which is a "On-Host" queue.</li>
</ul>
</li>
<li><code>time_per_instance</code>: maximum computation time for each module instance.</li>
<li><code>instance_per_job</code>: how many module instances to submit as one remote job. This is useful consolidating numerous light-weight module instances into one jobs submission. </li>
<li><code>n_cpu</code> and <code>mem_per_cpu</code> specify the CPU and memory requirement of a module instance.</li>
</ul>
<p>For example for 100 module instances of <code>simulate</code> that each generates some data in under a minute, one can specify <code>time_per_instance: 1m</code> and <code>instance_per_job: 200</code>. Then a single job containing 200 simulations will be submitted to the host with a total of 200 minutes computation time reserved.</p>
<p>Typically, <code>DSC</code> and <code>default</code> section for host configuration do not have to be changed for different projects. Users can carefully configure them once, and reuse for various projects. For Stephens Lab users for example, one can take the example from above and replace <code>gaow</code> with their UChicago cnetID.</p>
<p><strong>Please never use this template without configuring the required resources, particularly <code>time_per_instance</code> and <code>instance_per_job</code>. They should be tailored for your project. In proper configuration of these settings will lead to running many small jobs (too low on <code>instance_per_job</code>) and waste of resource (too high on <code>time_per_instance</code>)</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Control-number-of-jobs-to-submit">Control number of jobs to submit<a class="anchor-link" href="#Control-number-of-jobs-to-submit">&#182;</a></h2><p>In the configuration file, <code>max_running_jobs</code> confines the maximum number of jobs to run on the host. This is set to have a safe limit that prevents from harming the host sytem (and getting angry system emails). For each benchmark submitted, the command option <code>-c</code> should be used to customize the maximum number of jobs to have in the queue. Command <code>dsc -h</code> will show you the default value of this number. Since it is a shared command option with running jobs locally, the default is set to ~1/2 of the total available CPU threads on the computer that executes <code>dsc</code>. That is, for the "On-Host" submission the default number of jobs will be half of threads on the head node; for the "Local-Host" submission the default will be half of threads on a local computer, which can be quite small when running from, say, a regular laptop. It is thus advised to always specify <code>-c</code> option.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-remote-jobs">Run remote jobs<a class="anchor-link" href="#Run-remote-jobs">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If the <code>default</code> queue is a "On-Host" queue (<code>address: localhost</code>), then</p>

<pre><code>dsc ... --host /path/to/config.yml -c 30</code></pre>
<p>will configuration in <code>/path/to/config.yml</code> and submit jobs, in batches of 30.</p>
<p>For the "Local-Host" mechanism (<code>default::address: &lt;some URL&gt;</code>),</p>

<pre><code>dsc ... --host /path/to/config.yml --to-host file1 dir1 file2 -c 30</code></pre>
<p>will additionally use <code>--to-host</code> to sync specified files and folders to the remote, if the particular benchmark requires these files and folders to execute (eg, data resource, shell executables, or scripts in <code>DSC::lib_path</code>).</p>
<p>Caution that to successfully use <code>--to-host</code>, the command program <a href="https://rsync.samba.org"><code>rsync</code></a> have to be available from the local computer.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Monitor-and-manage-jobs">Monitor and manage jobs<a class="anchor-link" href="#Monitor-and-manage-jobs">&#182;</a></h2><p>When jobs are submitted, you should see on the screen something like:</p>

<pre><code>INFO: M2_9eb9ad957cc31d50 submitted to midway2 with job id 45634260</code></pre>
<p>So there is a task ID <code>M2_9eb9ad957cc31d50</code> and job ID <code>45634260</code>. This can also be observed from your system's job queue, for example:</p>

<pre><code>             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          45633096   broadwl M2_2eac6     gaow PD       0:00      1 (Priority)
          45633098   broadwl M2_c6ed0     gaow PD       0:00      1 (Priority)
          45633099   broadwl M2_38e36     gaow PD       0:00      1 (Priority)
          45633100   broadwl M2_8fea7     gaow PD       0:00      1 (Priority)
          45633101   broadwl M2_829d4     gaow PD       0:00      1 (Priority)
          45633102   broadwl M2_3ab21     gaow PD       0:00      1 (Priority)
          45633103   broadwl M2_ed42e     gaow PD       0:00      1 (Priority)
          45633104   broadwl M2_2966b     gaow PD       0:00      1 (Priority)
          45633086   broadwl M2_13151     gaow  R       0:01      1 midway2-0033
          45633087   broadwl M2_01df1     gaow  R       0:01      1 midway2-0033
          45633088   broadwl M2_b8668     gaow  R       0:01      1 midway2-0033
          45633089   broadwl M2_89a83     gaow  R       0:01      1 midway2-0070
          45633090   broadwl M2_7cbdd     gaow  R       0:01      1 midway2-0070
          45633091   broadwl M2_56fa6     gaow  R       0:01      1 midway2-0070
          45633092   broadwl M2_4baac     gaow  R       0:01      1 midway2-0070</code></pre>
<p>To check on one of the job, for example the first one:</p>
<div class="highlight"><pre><span></span>sos status M2_2eac6 -v3
</pre></div>
<p>You will see information such as:</p>

<pre><code>Started 27 min 13 sec ago
Duration 26 min 59 sec

TAGS:
=====
e0b204d49b525c52 susie2_0 susie2_sparse_13_susie2_1 susie2_sparse_14_susie2_1

...</code></pre>
<p>The <code>TAGS</code> line explains that the job comes from the module <code>susie2</code> and produces 2 files <code>susie2/sparse_13_susie2_1</code> and  <code>susie2/sparse_14_susie2_1</code>. That is, 2 module instances per job. There are also some other useful info on execution stats such as memory usage.</p>
<p>To have more details,</p>
<div class="highlight"><pre><span></span>sos status M2_2eac6 -v4
</pre></div>
<p>and the output:</p>

<pre><code>M2_2eac66b84134d3f8.err:
========================
2eac66b84134d3f8: completed
2018-05-02 07:49:50,749: DEBUG: 2eac66b84134d3f8 ``started``
2018-05-02 07:49:51,249: DEBUG: 2eac66b84134d3f8 ``completed``
c9afa00936023dba: completed
2018-05-02 07:49:51,299: DEBUG: c9afa00936023dba ``started``
2018-05-02 07:49:51,788: DEBUG: c9afa00936023dba ``completed``

M2_2eac66b84134d3f8.out:
========================
2eac66b84134d3f8: completed
output: {file_target('benchmark/susie2/sparse_13_susie2_1.rds'): '12e0ebc6506e00e2'}
c9afa00936023dba: completed
output: {file_target('benchmark/susie2/sparse_14_susie2_1.rds'): '98adf711379a200e'}

M2_2eac66b84134d3f8.sh:
=======================
#!/bin/bash
#SBATCH --time=00:10:00
#SBATCH --partition=broadwl
#
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=3
#SBATCH --mem-per-cpu=4G
#SBATCH --job-name=M2_2eac66b84134d3f8
#SBATCH --output=/scratch/midway2/gaow/GIT/lab-dsc/dsc-reg/.sos/M2_2eac66b84134d3f8.stdout
#SBATCH --error=/scratch/midway2/gaow/GIT/lab-dsc/dsc-reg/.sos/M2_2eac66b84134d3f8.stderr
cd /scratch/midway2/gaow/GIT/lab-dsc/dsc-reg
module load R/3.4.3
sos execute M2_2eac66b84134d3f8 -v 2 -s default</code></pre>
<p>You will see the actual SBATCH script submitted. Of perticular interest is perhaps the <code>stderr</code> and <code>stdout</code>. They record screen output of a job. To check them out:</p>

<pre><code>$ cat /scratch/midway2/gaow/GIT/lab-dsc/dsc-reg/.sos/M2_2eac66b84134d3f8.err
Note that the current default version of R is 3.4.3.
Type "module help R" for advice on using R on midway.</code></pre>
<p>So I get two lines of messages related to loading R modules and nothing else. This is perhaps a good sign that no error or warning messages were generated from my R-based jobs.</p>

</div>
</div>
</div>
<hr>
Copyright (c) 2016-2018 <a href="http://home.uchicago.edu/gaow">Gao Wang</a>, <a href="http://stephenslab.uchicago.edu">Matthew Stephens</a>, <a href="https://pcarbo.github.io">Peter Carbonetto</a> and contributors.<br>&nbsp;&nbsp;&nbsp; Except where otherwise noted, this website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.

</div>
</div>
</body>
</html>
